<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="image/png" sizes="192x192" rel="icon" href="misc/favicon-192x192.png">
<link type="image/png" sizes="16x16" rel="icon" href="misc/favicon.png">
<link rel="manifest" href="misc/manifest.json">
<meta name="theme-color" content="#e9e3cc">
<meta name="viewport" content="width=450">
<meta name="author" content="Morendil">
<meta name="description"  content="Ваш путеводитель по игрожуру 90х — поиск и каталог обзоров старых игр для IBM PC">
<title>Retroindex</title>
<style>
:root {
  --bg: #e9e3cc;
  --bg-img: url(misc/paper.jpg);
  --text: #000;
  --panel: #f4efda;
  --border: #bbb;
  --h2: #800000;
  --shadow: rgba(0,0,0,0.2);
  --error: #f883a2;
  --srch-border: #4c270e;
  --btn-border: #bbb;
  --table-border: #d2cdbc;
  --mod-zebra: #f0f5ff;
  --mod-border: #345fb9;
  --binv: 0;
  --hintext: #000;
}

.dark-mode {
  --bg: #293549;
  --bg-img: none;
  --text: #d4d4d4;
  --panel: #2d4a65;
  --border: #3d5a75;
  --h2: #6ab4ff;
  --shadow: rgba(0,0,0,0.6);
  --error: #8b2e3e;
  --srch-border: #6ab4ff;
  --btn-border: #495359;
  --table-border: #3d5a75;
  --mod-zebra: #243447;
  --mod-border: #4a90e2;
  --binv: 1;  
  --hintext: #fff;
}
HTML {overflow-y: scroll; transition: background 0.3s;}
BODY {background: var(--bg) var(--bg-img) scroll; margin: 0; color: var(--text); transition: color 0.3s;}
H1,H2,H3 {font-family: Arial;}
H2 {color: var(--h2);}
H2 A:hover{color: #b20f0b; cursor: pointer;}
H3 {color: var(--h2); display: inline; padding-bottom: 2px;}
H3:hover {color: #b20f0b; cursor: pointer;}
H3 A {text-decoration: none;}
TD A {display: block; width: 100%; padding: 15px 0; text-align: right; outline: none;}
P {margin-bottom: 0;}
@font-face {font-family: 'Antnum'; src: url('misc/antnum.woff2') format('woff2');}
#sInp {padding: 0 10px 0 36px; width: 250px; height: 32px; margin-right: 0; border-radius: 15px 0 0 15px; font-size:15px; outline: none; border: 0; background-color: var(--panel); color: var(--text); box-shadow: inset 1px 1px 1px rgba(0,0,0,0.2);}
#sInp:focus {background-color: var(--panel);}
#sBut {height: 32px; margin-left: 0; border-radius: 0 15px 15px 0; font-size:15px; border: 1px var(--srch-border) solid; background-color: var(--panel); color: var(--text); outline: none;}
.pBut {display: inline-block; height: 27px; width: 27px; background-color: rgba(127,127,127,0.1); border: var(--btn-border) 1px solid; border-radius: 50%; position: relative; left: 17px; user-select: none; font: bold 16px Arial; color: #baa; line-height: 27px;}
.tBut {user-select: none; height: 20px; width: 20px; margin-left: 3px; flex-shrink: 0; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAABhAgMAAAC7aCcwAAAABlBMVEX///+AAAC098j+AAAAAXRSTlMAQObYZgAAAVlJREFUeNrklbFuxjAIhG2p7P/C+7B09wDv/yo1LjkTS0hJ194E/hDBVnxuSaQ5+5/kleTIP1fQx0H0+HI3GxFchC1AIDIB8ciWBLmLvJR+ia4aTOC5heQ3Dc2QLqKTDBAejX1t8VkoICR9gYVmVYO6r1xzavsCiAUXSiCf6Ywwd95cCOk4inA+LNHuTrxYEG+ZYiVOGgMM9PckE2mEL4NEA95EM5k5Sllvo/VELBFttAklYiMI5kmEnxOE5gSFj0h/S8iaE93bS4ReEbMRxDbpZt+ZyB/IKIneCGZzVVPjQzfSDe0+QXBuaDeOE8XN5oM0g+QR8ZBBvPAZSU6RCWsmZMd/HfLGx13AaKyZCEbA/cGGtr/ZOO+pawUguNsu3G0MB4dd8ekhk8BD7r5jzrtp7VVP/K32xNpHa++t/br2+PpdqN+S+v2p36z6navfxp9hqU/JBqOtGgCMLcwkWsV5vwAAAABJRU5ErkJggg==); background-size: contain; filter:sepia(var(--binv)) invert(var(--binv));}
.tBut:hover {filter: invert(0.5); cursor: pointer;}
.pBut:hover{cursor: pointer; border-color: rgba(127,127,127,0.1); box-shadow: inset 1px 1px 0 rgba(0,0,0,0.2); left: 16px;}
#sel {height: 25px; margin-right: 0; font-size:14px; outline: none; border: 0; background-color: var(--panel);}
#prnt {display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; padding: 12px;} 
#sTab {background-color: var(--panel); min-width: 644px;  max-width: 1000px; height: 90px; width: 60vw; padding: 6px; box-sizing: border-box; border-top-right-radius: 4px; font: 14px Arial; flex: 2;}
#chAuto {background-color: var(--panel); border-radius: 15px;}
#modSel option:nth-child(2n) {background-color: #f0f5ff;}
#modSel {flex-basis: 292px; flex-grow: 1;}
.topSticky {position: sticky; top: 0; background-color: var(--bg); background-image: var(--bg-img); z-index: 100;}																																
.topBar {height: 45px; background-color: var(--bg); background-image: var(--bg-img); text-align: center; padding: 0 12px 0 8px; display: flex; margin: 0; align-items: center;}
.topRex {display: none;}
.topCenter {flex: 1 0 0; white-space: nowrap; height: 100%; padding-top: 3px;}
.topRight {padding-top: 1px;}
.dtab {flex: 1 0 0; min-width: 400px; max-width: 600px;}
.tRes {background-color: rgba(99,99,99,0.1); width: 100%; font: 14px Arial; border-collapse: collapse; text-align: center;}
.tRes TH {font-weight: normal; margin: 0; color: #fff;}
.colM TH {background-color: #345fb9;}
.colB TH {background-color: #5d9d52;}
.colN TH {background-color: #0d96a4;}
.colD TH {background-color: #8e3ca2;}
.colP TH {background-color: #b20f0b;}
.colV TH {background-color: #fd8405;}
.gal {text-align: center; padding-bottom: 40px; max-width: 1800px;}
.gal img {padding: 0; min-height: 128px;}
.gal span:hover div {display: block;}
.gal span {position: relative; display: inline-block; width: 128px; cursor: help;}
.galHint {display: none; position: absolute; bottom: 0; left: 0; padding: 3px; min-width: 30px; background-color: rgba(0, 128, 0, 0.7); color: #fff; font: bold 16px Arial; z-index: 2; border-radius: 0 5px 0 0;}
.galHint a {color: white; text-decoration: none; display: inline-block; width: 100%;}
.galIss {display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(0,0,0,0.5); text-shadow: 0px 0px 10px rgba(255,255,255,0.9); pointer-events: none; font-size: 60px; font-family: Impact, Antnum, sans-serif; z-index: 2;}
.galDis {display: inline-block; color: rgba(0,0,0,0.3); text-shadow: none;}
.cov {width: 64px; cursor: pointer;}
.mobSelect {display: none;}
.tRes TH:nth-child(1) {width: 64px;}
.tRes TH:nth-child(2) {height: 25px; white-space: nowrap; border-right: 1px solid #d2cdbc;}
.tRes TH:nth-child(3) {border-top-right-radius: 4px; width: 36px;}
.tRes TH, TD {padding: 0;}
.flexFix {height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0;}
.errMsg {background-color: var(--error); max-width: 400px; padding: 15px; margin-top: 30px; border-radius: 15px; font: 14px Arial;}
.infMsg {background-color: var(--panel); color: var(--text); min-width: 640px; width: 60vw; padding: 15px; margin: 30px 0; border-radius: 15px; font: 14px Arial;}
.infMsg A {color: #28bf46;}
.cb {position: relative; left: 31px; top: 9px;}
.sar {border-radius: 15px;}
.ns {user-select: none; cursor: pointer !important;}
.mc {font-size: 12px; opacity: 0.4; float: right;}
#chAuto {display: none;}
#chAuto + label:before {display: inline-block; cursor: pointer; height: 28px; width: 28px; content: ""; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3ZmJlM2FiMS0yNDQ3LWIzNDktODYwMi1iOThmMGZjMmUwMTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUVBQjExNzMwRTVEMTFGMTg5QjI4RTU4QkEwNjQyQTkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RUVBQjExNzIwRTVEMTFGMTg5QjI4RTU4QkEwNjQyQTkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6YWMyOTcxZmQtNThmZC1iZDQwLThlMjgtNWIxNjU5ZWU0MGZmIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6Yjg0MTQ3NTgtMGU1ZC0xMWYxLTg4NjktOGEyMjM3Y2E0OTI1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+1osfqQAAAAZQTFRFTCcO////Tn3R7QAAAAJ0Uk5T/wDltzBKAAAB+ElEQVR42uyZSXLEIAxFP/e/dBadbjNoHpxKl7018AySvoSMccMDwxD0Q/AtEPRCXov3Qn5XdzHQD2E3DW2OHQJwFA1iNwlCkPc0OBBxCBwMN8RMeY8KGH7+PpgsHoJcthcwmBkRyLhmswtcrxIQSH62HKcRcg6av/JcYzUae6bYp7BSAfILJqPBAqGHiZ617VOHCKduD0YFwoerQ1eUDCD6aE7oV0gy/ZkgyfpBh6AEMr4ZgloIoYMfUWMgaW9blLMFgk056UUzDKxPAwSU+pPahSgDu+pTkCkNZvZxOecG2c4yK2CfGhdUZkwxxpxHT8Or9WxgJ3uc1F10J4tfxHrIWed1QI4zr4aMWyBUmNVDYm2P/whBOhglyJkCmvz6TkiLTVpX/9ikGzJf9qowVNmDaufdV1qXLcLsbgSiDiqrHGcSzP2kxHYQbAu5MgspKyh2YNCn2AzpqF5QG4p0uDcnrVsgTyHxtxBfXzgUMlKoQb/3+SXR1EXwU5bscTYy+YOF848Df3WG0LVy/XKQegAQO2NGijarAkI1ZgSIOrwLghAEImSEIOMOSNlOtljoMTwLGTkIzJB4nMABgS/iOVnhIYfiGbQLtHQJEOVm65B6CeLMJ3zSEiFitQ5jo0eHjOgfUyekoFp5IA+kFxK79z2QLkj8+RFgADllIVH1f4uKAAAAAElFTkSuQmCC); background-size: contain; filter: invert(var(--binv));}
#chAuto:checked + label:before {display: inline-block; cursor: pointer; height: 28px; width: 28px; content: ""; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3ZmJlM2FiMS0yNDQ3LWIzNDktODYwMi1iOThmMGZjMmUwMTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RTYxQTAzMjAwRTVEMTFGMUI2RjJFREU2QzQyQTUxMTkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RTYxQTAzMUYwRTVEMTFGMUI2RjJFREU2QzQyQTUxMTkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6YWMyOTcxZmQtNThmZC1iZDQwLThlMjgtNWIxNjU5ZWU0MGZmIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6Yjg0MTQ3NTgtMGU1ZC0xMWYxLTg4NjktOGEyMjM3Y2E0OTI1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+1BDtdAAAAAZQTFRFTCcO////Tn3R7QAAAAJ0Uk5T/wDltzBKAAACG0lEQVR42uzZSZLDIAwF0M/9L92LTsoYTV9CuLpT8TbGz2aQBMF44AJxC84j+BQEZ5Hfh59FXk9PGTiPmB+NqA2PAJYSIfyQoIS8myFB1BEkjDRCK++7CgM/vx+oES8h19g7DGajgoyrtfmA66cNBN48u3Unicib5reUz7gPmtmnWJuYoQLqG0yDBgbRb3Nn1vKdMeL0Or8YA8Rerom4EmQAd47uBfo7spn+KGSzfogRtCDjkxHsIUoT6xYLQQExl+cZBEvk1JuQOTcU9hArVEGL/mrsAtdZVuy/J0uBTGmw1FkigS3I0pfFILLkewhkJAwHUao9sPVs4UvWddIW2OcRv8R+RNZ5KBM2In7tRkYvkniBfqR27PEfEWe9L3OygsgU0ItoV4Dwe2ILIUZhA+GXX7qkxTiNzJu9RHXi3quVPaBPOHgEYgDphEXscuVMkkVJsCerIK+dK32eNBcH3DTREaAJWZ6mhpUQSU5g6L14GGmIDmLZIFFsFRC8kUKk+1tIJf1+DlI8HmlEcufC7jkysR0lEH9lxoW2tpWM8kGuAjfOQ/1j3sw/DvbWGVHpk58NIZI/mGBadSDawYyDhLefQlBC4CKjhIwnkLYvWdbCmYE3kbGHgEbq6wQJBLkVb4UVGxERj4hd0EOXgwQ720So95BkPrGTlou41TrIg54YGdV/TJNIQ7XyRb7IWQSVLd0XeeI0NXn9CDAAatYgPZ9P1V4AAAAASUVORK5CYII=); background-size: contain; filter: invert(var(--binv));}
#covModal {display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.5); z-index: 150; align-items: center; justify-content: center;}
#modContent {background: var(--bg) var(--bg-img); border-radius: 15px; padding: 10px; border: 3px solid #345fb9; width: 450px; z-index: 20; display: flex; align-items: flex-start;}
#hintBar {margin-top: 5px; padding: 0 10px 5px 5px; min-height: 22px; background-color: rgba(127,127,127,0.1); border-top: var(--btn-border) 1px dotted; border-bottom: var(--btn-border) 1px dotted;}
#hintBar span {display: inline-block; border-radius: 4px; font: 12px Arial; padding: 1px 3px; margin-left: 5px; margin-top: 5px; background-color: var(--panel); color: var(--hintext); white-space: nowrap;}
#hintBar span:hover {background-color: gold; color: #000; cursor: pointer;}
nav {white-space: nowrap;}
nav ul {padding:0; margin:0; list-style: none; position: relative;}
nav ul li {margin: 0; display:inline-block; background-color: var(--panel);}
nav a {display:block; text-align: left; padding:0 5px; color: var(--text); font: 15px Arial; line-height: 30px; text-decoration:none; cursor: pointer; border-top: 1px var(--border) dotted;}
li:nth-child(20) a {border-top: 1px #345fb9 dotted;}
nav a:hover {background-color: #b20f0b; color: #fff;}
nav ul ul {display: none; position: absolute; top: 100%; left: 0;}
nav ul li:hover > ul {display:inherit;}
nav ul ul li {width:262px; display:list-item; position: relative;}
.ulM {border-left: 3px #345fb9 solid;}
.ulB {border-left: 3px #5d9d52 solid;}
.ulN {border-left: 3px #0d96a4 solid;}
.ulD {border-left: 3px #8e3ca2 solid;}
.ulP {border-left: 3px #b20f0b solid;}
.grD {background-image: linear-gradient(90deg, rgba(142,60,162,0.3), rgba(142,60,162,0));}
.grP {background-image: linear-gradient(90deg, rgba(178,15,11,0.3), rgba(178,15,11,0));}
.linkM {border-bottom: 3px #345fb9 solid;}
.linkN {border-bottom: 3px #0d96a4 solid;}
.linkB {border-bottom: 3px #5d9d52 solid;}
.missing {filter: saturate(0); opacity:0.5;}
.missing:hover {filter: saturate(1); opacity:1; cursor: default;}
.homeStats {display: flex; justify-content: center; flex-wrap: wrap; margin-top: 20px; font-family: Arial, sans-serif;}
@media (max-width: 960px) { 
#hintBar {display: none;}
#sTab {display: none;}
.topLeft {display: none;}
.topRex {display: block;}
}
@media (max-height: 600px) {
.sar {display: none;}}					  
@media (max-width: 600px) { 
.topBar {border-bottom: 0;}
#covModal {align-items: flex-end; height: fill-available; height: -webkit-fill-available;}
#modContent {border-radius: 0; border-width: 5px 0 0 0; padding:0; width: 100vw;}
#modSel {flex-grow: 1;}
#prnt {gap: 0; padding: 0;}
.homeStats {margin: 0 10px;}
.mobSelect {display: block;}
.topBar {margin-bottom: 12px;}
.topRight {display: none;}
.cov {width: 80px;}
.tRes {background-color: rgba(127,127,127,0.1);}
.tRes TH:nth-child(3) {border-top-right-radius: 0;} 
#statTab, #yTab { width: 100% !important; font-size: 12px; }
#statTab td, #yTab td { padding: 4px 2px; }										
}
</style>
<script src="tv.js"></script>
<script src="mags.js"></script>
<script src="books.js"></script>
<script src="papers.js"></script>
<script src="digital.js"></script>
<script src="links.js"></script>
<script src="tools.js"></script>
</head>
<body> 
<div class="topSticky"><div class="topBar">
<div class="topRex"><img src="misc/rex.png" width="65" height="30" style="filter:sepia(var(--binv)) invert(var(--binv))"></div>
<div class="topLeft"><a href="https://retroindex.github.io"><img src="misc/retrologo.png" width="197" height="30" style="filter:sepia(var(--binv)) invert(var(--binv))"></a></div>
<div class="tBut" id="tglBtn" onClick="toggleTheme()" title="Сменить тему" style="position: relative; bottom: 6px;"></div>
<div class="topCenter"><span class="pBut topLeft" onClick="prntMsg()">?</span>
<span class="cb"><input type="checkbox" id="chAuto" checked><label for="chAuto"></label></span><input type="search" id="sInp" autocomplete="off"><input type="button" id="sBut" value="Поиск " onclick="wrapper(sInp.value.trim())"><span class="pBut topLeft" id="sortBtn" onClick="sortTabs()" title="Сортировка по дате">&#8645;</span></div>
<div class="topRight" id="topRightCnt"></div></div><div id="hintBar"></div></div>
<div id="prnt"></div>
<div id="covModal"><div id="modContent"></div></div>								
<div style="opacity: 0; font-size: 1px; font-family: Impact, Antnum;">2019</div>
<script type="text/javascript">

let sel = "<nav><ul><li><a>Журналы</a><ul class='ulM'>"; 
let maKeys = []; let npKeys = []; let maMisc = []; let msCount = 0;
let stdLoad = true; let Gstat = {articles: "60.000+", games: "11.000+", mags: 0, books: 0, papers: 0, dmag: 0, dpdf: 0};
for (let i=0; i<mags.length; i++) {
	let [magName,magPref,magType] = mags[i][0].split("|");	maKeys.push(magPref); 
	if (!magType) sel += "<li><a onclick='showGal("+i+")'>"+magName+"<span class='mc'>"+(mags[i].length-1)+"</span></a></li>";
	if (magType == "1" || magType == "2") {maMisc.push(i); msCount += (mags[i].length-1)};
	Gstat.mags += mags[i].length-1;
	}
sel+="<li><a onclick='showMiscGal()'>Прочие журналы <span class='mc'>"+maMisc.length+"&nbsp; / &nbsp;"+(msCount)+"</span></a></li></ul></li><li><a>Книги</a><ul class='ulB'>"
for (let i=0; i<books.length; i++) {sel+= "<li><a onclick='showBookGal("+i+")'>"+books[i][0]+"</a></li>"; Gstat.books += books[i].length-1;} sel += "</ul></li><li><a>Газеты</a><ul class='ulN'>"
for (let i=0; i<papers.length; i++) {
	let [papName,papPref] = papers[i][0].split("|"); npKeys.push(papPref); 
	sel+= "<li><a onclick='showPaperGal("+i+")'>"+papName+"<span class='mc'>"+(papers[i].length-1)+"</span></a></li>"; Gstat.papers += papers[i].length-1;}
sel += "</ul></li><li><a>Цифра</a><ul><li class='ulD grD'><a>Дискмаги <span class='mc'>EXE</span></a></li>"
for (let i=0; i<dis.length; i++) {sel+= "<li class='ulD'><a onclick='showDiscGal("+i+")'>"+dis[i][0].split("|")[0]+"<span class='mc'>"+(dis[i].length-1)+"</span></a></li>"; Gstat.dmag += dis[i].length-1;} sel += "<li class='ulP grP'><a>Электронные журналы <span class='mc'>PDF</span></a></li>"
for (let i=0; i<PDFs.length; i++) {sel+= "<li class='ulP'><a onclick='showPDFGal("+i+")'>"+PDFs[i][0].split("|")[0]+"<span class='mc'>"+(PDFs[i].length-1)+"</span></a></li>"; Gstat.dpdf += PDFs[i].length-1;}
sel+="</ul></li><li><a onclick='showTVGal()'>ТВ</a></li></ul></nav>";

topRightCnt.innerHTML = sel;

let sBtn = document.getElementById('sortBtn');
sBtn.addEventListener('click', function() {if (sBtn.style.color) sBtn.removeAttribute("style"); else sBtn.style.color = "#d00"; sortTabs();});

window.newHints = true;
let skipNavState = false;
if (window.location.hash) {
stdLoad = false;
let sHash = window.location.hash.substring(1);
history.replaceState(null, document.title, location.pathname);
if (hashTags.hasOwnProperty(sHash)) showGal(maKeys.indexOf(hashTags[sHash]));
else if (Number(sHash)>1991 && Number(sHash)<=2018) showYear(Number(sHash));
else {
if (sHash.indexOf('%')>=0) sHash = decodeURI(sHash); 
sHash = sHash.split('_').join(' '); sInp.value = sHash;
history.replaceState({action: 'search', data: {q: sHash}}, '');							   
wrapper(sHash);
if (sHash.indexOf('+')>=0) sBtn.click();
}}

let timeout = null;	// debounce
sInp.onkeyup = function (e) {if (chAuto.checked) {clearTimeout(timeout); timeout = setTimeout(function () {wrapper(sInp.value.trim())}, 500)}};
document.addEventListener('keyup', function(event) {if (event.key == 'Enter' && sInp.value != '') wrapper(sInp.value.trim());});
document.addEventListener('keydown', function(event) {if (event.key == 'Escape') {if (modal.style.display == 'flex') modal.style.display = 'none'; else {sInp.value=''; hintBar.innerHTML=''}}});
window.addEventListener('hashchange', function() {location.reload();}, false);

function navState(action, data) {
    if (skipNavState) return;
    history.pushState({action, data}, '');
}
window.onpopstate = function(e) {
    skipNavState = true;
    if (!e.state) { renderHomeStats(); hintBar.innerHTML = ''; skipNavState = false; return; }
    const {action, data} = e.state;
    if (action === 'gal') showGal(data.idx);
    else if (action === 'book') showBookGal(data.idx);
    else if (action === 'paper') showPaperGal(data.idx);
    else if (action === 'pdf') showPDFGal(data.idx);
    else if (action === 'disc') showDiscGal(data.idx);
    else if (action === 'tv') showTVGal();
    else if (action === 'misc') showMiscGal();
    else if (action === 'stats') showStats();
    else if (action === 'yearStats') showYearStats();
    else if (action === 'year') showYear(data.year);
    else if (action === 'search') { sInp.value = data.q; wrapper(data.q); }
    else { renderHomeStats(); hintBar.innerHTML = ''; }
    setTimeout(() => skipNavState = false, 10);
}; 

function wrapper(wReg) {
if (wReg) navState('search', {q: wReg});	  
let triedAbbr = false;

wReg = wReg.replace(/[*+,|?{}\[\]\(\)\\]/g, '');
if (document.getElementById('sel')) document.getElementById('sel').value="";

if (!globalSearch(wReg)) {
	if (!triedAbbr) {
		triedAbbr = true;
		if (wReg.length < 2) return;
		wReg = wReg.replace(/\s+/g, '').substr(0,5).split("").join(" ");
		if (!globalSearch(wReg)) {prnt.innerHTML = '<div class="errMsg">Подстроки и аббревиатура "<b>'+wReg+'</b>" не найдены.<br>Возможно, игра вышла позже 2018 года, или не на PC.</div>'; hintBar.innerHTML = '';}
		}
	}
}


function globalSearch(sReg) {
	const start = new Date().getTime();
let re = "";
gHint = []; hinTemp = [];
if (/^(of?)?\s*(t|th|the)?$/i.test(sReg)) return;
if (/(^|\s)[^0-9 .'-]{2,}\d+$/i.test(sReg)) sReg = sReg.replace(/\d+$/,' $&');
if (sReg.length<3 || sReg.indexOf('=')>=0) re = new RegExp("(^|\\|)"+sReg.replace('=','')+"( \\(.+\\))*($|,)","i")
	else {
	let sRegArray = sReg.split(/\s+/);
	let reString = "(^|\\||«|\\(|\\s+)"+sRegArray[0];
	if (sRegArray.length>1) for (let i=1; i<sRegArray.length; i++) reString += "[^,]*(«|\\(|\\s+)"+sRegArray[i]; 
	reString = reString.replace(/\./g, '\\.');
	re = new RegExp(reString,"i");
	}

///// Книги

let bookRes = "";
let bookArray = [];
for (let g=0; g<books.length; g++) {
	for (let i=1; i<books[g].length; i++) {
		if (re.test(books[g][i])) {
			bookArray = books[g][i].split('|');
			let [bName,bISBN,bPub,bYear,bQty] = book_details[bookArray[0]].split("|");
			for (let j=1; j<bookArray.length; j++) {
				let [bGame, bPage] = bookArray[j].split(",");
				if (re.test(bookArray[j])) { 
					bookRes += "<div class='dtab' data-pub="+bYear+"06><table class='tRes colB'><tr><th rowspan=2><img class='cov' id='b-"+g+"-"+i+"' src='cvs/b_"+bookArray[0]+".jpg' onclick='showModal(this)'></th><th>"+bGame+"</th><th>"+bPage+"</th></tr><tr><td>"+bName+"<br>Издательство "+bPub+", "+bYear+"<br>ISBN: "+bISBN+"</td><td>"+getLink(bookArray[0],bPage)+"</td></tr></table></div>"				
					addUnique(bGame);
				}
			}
		}
	}
 }	
	
///// Журналы

let magRes = "";
let magArray = [];
for (let g=0; g<mags.length; g++) {
	let numfix=0;
	if (g==maKeys.indexOf('exe')) numfix+=17; if (g==maKeys.indexOf('lki')) numfix+=13;
	for (let i=1; i<mags[g].length; i++) {
		if (mags[g][i].slice(3,5).indexOf("-")>-1){ numfix++; if (g==maKeys.indexOf('mik') && (i==237||i==238)) numfix++;}
		if (mags[g][i].slice(3,6).indexOf("_|")>-1) numfix--;
		if (re.test(mags[g][i])) {
			magArray = mags[g][i].split('|');
			let [magName, magPref, magType] = mags[g][0].split("|");
			let magNum = magArray[0];
			if (magNum.indexOf('_')>-1) {magNum = (magNum.slice(-1)=='_') ? magNum.replace('_','') : magNum.replace('_','-');}
			magName += " №"+magNum.slice(2);
			if ((magNum.slice(2) != (i+numfix)) && (magNum.slice(3).indexOf("-")<0) && (magType != "1")) magName += " ("+(i+numfix)+")";
			magName += "’"+magNum.slice(0,2);
			for (let j=1; j<magArray.length; j++) {
				let [magGame, magPage] = magArray[j].split(",");
				if (re.test(magArray[j])) 	{
											magRes += "<div class='dtab' data-pub="+getDate(magNum,g)+"><table class='tRes colM'><tr><th rowspan=2><img class='cov' id='m-"+g+"-"+i+"' src='cvs/"+magPref+magArray[0]+".jpg' onclick='showModal(this)'></th><th>"+magGame+"</th><th>"+magPage+"</th></tr><tr><td>"+magName+"</td><td>"+getLink(magPref+magArray[0],magPage)+"</td></tr></table></div>";
											addUnique(magGame);
											}
			}
		}
	}
 }

///// Газеты

let papRes = "";
let papArray = [];
for (let g=0; g<papers.length; g++) {
	let numfix=0;
	for (let i=1; i<papers[g].length; i++) {
		if (papers[g][i].slice(3,5).indexOf("-")>-1) numfix++; 
		if (papers[g][i].slice(3,6).indexOf("_|")>-1) numfix--;
		if (re.test(papers[g][i])) {
			papArray = papers[g][i].split('|');
			let [papName, papPref] = papers[g][0].split("|");
			let [yearNum, hardNum] = papArray[0].split("@");
			if (yearNum.indexOf('_')>-1) {yearNum = (yearNum.slice(-1)=='_') ? yearNum.replace('_','') : yearNum.replace('_','-');}
			papName += " №"+yearNum.slice(2);
			if (hardNum) papName += " ("+(hardNum)+")";
				else if ((yearNum.slice(2) != (i+numfix)) && (yearNum.slice(3).indexOf("-")<0)) papName += " ("+(i+numfix)+")";
			papName += "’"+yearNum.slice(0,2);
			for (let j=1; j<papArray.length; j++) {
				let [papGame, papPage] = papArray[j].split(",");
				if (re.test(papArray[j])) 	{
											papRes += "<div class='dtab' data-pub="+getDate(yearNum,g)+"><table class='tRes colN'><tr><th rowspan=2><img class='cov' id='n-"+g+"-"+i+"' src='cvs/"+papPref+yearNum+".jpg' onclick='showModal(this)'></th><th>"+papGame+"</th><th>"+papPage+"</th></tr><tr><td>"+papName+"</td><td>"+getLink(papPref+yearNum,papPage,i+numfix)+"</td></tr></table></div>";
											addUnique(papGame);
											}
			}
		}
	}
 }

///// Дискмаги

let discRes = "";
let discArray = [];
let dType = "misc/fd.png";
let cds = "";
for (let g=0; g<dis.length; g++) {
	let numfix=0;
	if (g>1) {dType = 'misc/cd.png'; cds = "style='padding-top: 25px'"}
	for (let i=1; i<dis[g].length; i++) {
		discArray = dis[g][i].split('|');
		let [discName, discPref] = dis[g][0].split("|");
		discName += " №"+discArray[0].slice(2);
		if (discArray[0].slice(2).indexOf("-")>0) numfix++;
		else if ((discArray[0].slice(2) != (i+numfix)) && (g!=1)) discName += " ("+(i+numfix)+")";
		discName += "’"+discArray[0].slice(0,2);
		for (let j=1; j<discArray.length; j++) {
			if (re.test(discArray[j])) {	discRes += "<div class='dtab' data-pub="+getDate(discArray[0])+"><table class='tRes colD'><tr><th rowspan=2><img class='cov' id='d-"+g+"-"+i+"' src='cvs/d_"+discPref+discArray[0]+".jpg'"+cds+" onclick='showModal(this)'></th><th>"+discArray[j]+"</th><th><img src='"+dType+"'></th></tr><tr><td>"+discName+"</td><td>*</td></tr></table></div>";
											addUnique(discArray[j]);}
		}
	}
 }

///// PDF

let PDFRes = "";
let PDFArray = [];
let exNum = ['glu','ox','rp'];
for (let g=0; g<PDFs.length; g++) {
	for (let i=1; i<PDFs[g].length; i++) {
		if (re.test(PDFs[g][i])) {
			PDFArray = PDFs[g][i].split('|');
			let [PDFName,PDFPref] = PDFs[g][0].split("|");
			PDFName += " №"+PDFArray[0].slice(2);
			if ((PDFArray[0].slice(2) != i) && exNum.indexOf(PDFPref) < 0) PDFName += " ("+i+")";
			PDFName += "’"+PDFArray[0].slice(0,2);
			for (let j=1; j<PDFArray.length; j++) {
				let [PDFGame, PDFPage] = PDFArray[j].split(",");
				if (re.test(PDFArray[j])) {PDFRes += "<div class='dtab' data-pub="+getDate(PDFArray[0])+"><table class='tRes colP'><tr><th rowspan=2><img class='cov' id='p-"+g+"-"+i+"' src='cvs/"+PDFPref+PDFArray[0]+".jpg' onclick='showModal(this)'></th><th>"+PDFGame+"</th><th>"+PDFPage+"</th></tr><tr><td id='"+PDFPref+PDFArray[0]+"'>"+PDFName+"</td><td>"+getLink(PDFPref+PDFArray[0],PDFPage)+"</td></tr></table></div>";
				addUnique(PDFGame);}
			}
		}
	}
 }	
	
///// ТВ
	
let vidArray = [];
let vidGames = [];
let vidRes = "";
for (let i=0; i<otvinta.length; i++) {
vidArray = otvinta[i].split('|');
vidGames = vidArray[1].split('+');  
for (let j=0; j<vidGames.length; j++) if (re.test(vidGames[j])) {
	vidRes += "<div class='dtab' data-pub="+vidArray[2].slice(-4)+vidArray[2].slice(3,5)+"><table class='tRes colV'><tr><th rowspan=2><img class='cov' src='cvs/tv_ov.jpg' id='v-ov' onclick='showModal(this)'></th><th>"+vidGames[j]+"</th><th>"+(i+1)+"</th></tr><tr><td>От винта! Выпуск "+(i+1);
	if (i > 48) vidRes += " ("+vidArray[0]+" по Игромании)";
	let restGames = vidGames.slice(0); 	restGames.splice(j, 1);
	if (restGames.length>0) vidRes += "<br><div style='font-size: 13px; color: #777; padding: 0px 20px'>+ <nobr>"+restGames.join("</nobr>, <nobr>")+" +</nobr></div>"
	vidRes += "</td><td>*</td></tr></table></div>";
	}
}
for (let g=0; g<tvs.length; g++) {
	let [tvName, tvPref] = tvs[g][0].split("|");
	for (let i=1; i<tvs[g].length; i++) {
		let vidPref = "https://www.youtube.com/watch?v=";
		vidArray = tvs[g][i].split('|'); vidGames = vidArray[0].split('+');  
		for (let j=0; j<vidGames.length; j++) if (re.test(vidGames[j])) {
			vidRes += "<div class='dtab' data-pub="+vidArray[1].slice(-4)+vidArray[1].slice(3,5)+"><table class='tRes colV'><tr><th rowspan=2><img class='cov' src='cvs/tv_"+tvPref+".jpg' id='v-"+g+"' onclick='showModal(this)'></th><th>"+vidGames[j]+"</th><th>"+i+"</th></tr><tr><td>";
			vidRes += tvName + "<br> Выпуск "+i+" от "+vidArray[1]+"</td><td>";
			if (vidArray[2]) {
				if (vidArray[2].indexOf('/')>-1) vidPref = '';
				vidRes += "<a href='"+vidPref+vidArray[2]+"' target='_blank'><img width='26' src='misc/linked.png'></a></td></tr></table></div>";
			}
			else vidRes += "<img width='15' src='misc/nolink.png'></td></tr></table></div>";
		}
	}
}

function addUnique(game) {
if (game.indexOf("(")<0) {
	if ((gHint.indexOf(game)<0) && (hinTemp.indexOf(game)>=0)) gHint.push(game);
	if (hinTemp.indexOf(game)<0) hinTemp.push(game);
	}
}
if (bookRes+magRes+vidRes+PDFRes+discRes+papRes=="") return false;
let gridFix = "<div class='dtab flexFix' data-pub='999999'></div>";
let gHintBuffer = ''; 
gHint.sort(function(a, b) {a = a.replace(/(\D):/ig, '$1 1:'); b = b.replace(/(\D):/ig, '$1 1:'); return a.localeCompare(b);});
for (i=0; i<gHint.length; i++) gHintBuffer += '<span title=\"'+gHint[i]+'\" onClick="window.newHints=false; wrapper(this.title+\'=\');">'+gHint[i]+'</span>'; 
if (gHint.length == 1) gHintBuffer = '';
if (window.newHints) hintBar.innerHTML = gHintBuffer;
else window.newHints = true;


if (gHint.length < 64) {
	let gameHeader = '<div id="sTab"></div>';
	prnt.innerHTML = gameHeader + magRes + bookRes + papRes + discRes + PDFRes + vidRes + gridFix.repeat(4);

///// Виджет статистики по годам

	function getYearBarHtml() {
		let yearCounts = {};
		let gCards = document.querySelectorAll('.dtab');
		for (let y = 1994; y <= 2018; y++) yearCounts[y] = 0;
		for (let i=0; i<gCards.length-4; i++) {
			for (let y = 1994; y <= 2018; y++) if (gCards[i].getAttribute('data-pub').substr(0,4).toString() == y.toString()) yearCounts[y] ++; }
		const maxCount = Math.max(...Object.values(yearCounts), 1);
		let barsHtml = '';
		for (let y = 1994; y <= 2018; y++) {
			let h = yearCounts[y] > 0 ? Math.round((yearCounts[y] / maxCount) * 50) + 10 : 2;
			let bg = yearCounts[y] > 0 ? '#345fb9' : '#ddd';
			barsHtml += `<div style="flex:1;display:flex;flex-direction:column;align-items:center;margin:0 1px;"><div style="width:100%;background:${bg};height:${h}px;border-radius:2px 2px 0 0;cursor:pointer;"`
				if (h>2) barsHtml += `onclick="tabsYearFilter(this, ${y.toString()})"`
			barsHtml += `title="${y}: ${yearCounts[y]}"></div><span style="font:11px Arial;margin-top:2px;white-space:nowrap;")>${y.toString().slice(-2)}</span></div>`; }
	return `<div style="position: relative"><div style="display:flex;height:80px;align-items:flex-end;">${barsHtml}</div><span style="position: absolute; top: 0; right: 0; font-weight: bold; cursor: pointer;" onclick="document.getElementById('sTab').style.display='none'; resetYF();">X</span></div>`; };	

document.getElementById("sTab").innerHTML = getYearBarHtml();
	
}							
else prnt.innerHTML = '<div class="errMsg">Уточните запрос, или выберите игру из списка ('+gHint.length+')</div>';
const end = new Date().getTime();
console.log(end - start, "ms");
if (sBtn.style.color) {sortTabs()};
return true;
}


function getLink (mag,page,iss) {
if (!webLinks.hasOwnProperty(mag)) {
	if (mag.slice(0,2)=='vr') return "<a href='https://archive.org/stream/VirtualnieRadosti_"+String(iss).padStart(3,'0')+"#page/n"+(Number(page)-1)+"/mode/1up' target='_blank'><img width='26' src='misc/linked.png'></a>";
	return "<img width='15' src='misc/nolink.png'>";}
let [webName, offset, fixes] = webLinks[mag].split("|");
if (fixes) {
	if ((fixes.indexOf('p')==0) && (Number(page) > (Number(fixes.slice(1))))) offset-=4;	// Сквозной постер
	else {
		let missPages = fixes.split(","); let i=0;
		while (Number(page) >= Math.abs(missPages[i])) {
			Number(missPages[i]) < 0 ? offset++ : offset--;
			i++;
		}
	}
}
let web1p = Number(page)+Number(offset)-1; 
let web2p = (web1p%2) == 0 ? web1p-1 : web1p;
if (iss || window.innerWidth < 800 || (window.innerWidth < window.screen.width/2)) return "<a href='https://archive.org/stream/"+webName+"#page/n"+web1p+"/mode/1up' target='_blank'><img width='26' src='misc/linked.png'></a>";
else return "<a href='https://archive.org/stream/"+webName+"#page/n"+web2p+"/mode/2up' target='_blank'><img width='26' src='misc/linked.png'></a>";
}

function getGalLink (mag,p) {
if (!webLinks.hasOwnProperty(mag)) return "<span><div class='galHint' style='background-color: rgba(255,0,0,0.5)'>"+mag.replace(/(\D_)|[^0-9-_]|_$/g, '').replace('_','-').slice(2)+"</div>";
let [webName, offset] = webLinks[mag].split("|");
if (!p) p = 2;
return "<span><div class='galHint'><a href='https://archive.org/stream/"+webName+"#page/n0/mode/"+p+"up' target='_blank'>"+mag.replace(/(\D_)|[^0-9-_]|_$/g, '').replace('_','-').slice(2)+"</a></div>";
}

function generateLink (mag,iss) { 
if (iss>4) iss++;
return "<span><div class='galHint'><a href='https://archive.org/stream/VirtualnieRadosti_"+String(iss).padStart(3,'0')+"#page/n0/mode/1up' target='_blank'>"+mag.replace(/(\D_)|[^0-9-_]|_$/g, '').slice(2)+"</a></div>";
}

function getSiteLink (mag,iss) {
let gRes = "<span><div class='galHint' style='background-color: rgba(0, 116, 232, 0.7)'><a href='"; 
if (mag=='im') gRes += "https://www.igromania.ru/magazine/"+iss+"/"; else if (mag=='mf') gRes += "https://www.mirf.ru/magazine/mir-fantastiki-"+iss+"/"; else if (mag=='lki') gRes += "http://lki.ru/archive.php?Num="+(iss+13); 
return gRes+"' target='_blank'>";
}

function getDate (gd,magID) {
let pubYear = gd.slice(0,2);
let fullYear = (pubYear > 90) ? "19"+pubYear : "20"+pubYear;
let pubMon = gd.slice(2);
if (pubMon.indexOf('-')>-1) pubMon = pubMon.split('-')[1];
if (magID) {
	if (magID==maKeys.indexOf('gl') && fullYear>1998 && fullYear<2011) pubMon = Math.ceil(pubMon/2).toString();
	if (magID==maKeys.indexOf('mik')) {if (fullYear>2002 && fullYear<2007) pubMon = Math.ceil(pubMon/4).toString(); else if (fullYear>2000) pubMon = Math.ceil(pubMon/2).toString();}
	if (magID==npKeys.indexOf('dm')) pubMon = Math.ceil(pubMon/4).toString();
}
if (pubMon.length==1) pubMon = "0"+pubMon;
return(fullYear+pubMon);
}

function showGal(mt,ms) {
navState('gal', {idx: mt});
let galArray = []; let cl = 0;
let pubYear = '', issNum = '', lazyLoad = '', numfix=0, fullYear;
let [magName, magPref] = mags[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
if (magPref=='comp') {cl = maKeys.indexOf('bah'); galRes += "<h3 class='linkM' onClick='showGal("+cl+")'>Сигнальный номер: Ба-Бах!</h3>";}
if (magPref=='nim') galRes += "<h3 class='linkB' onClick='showBookGal(0)'>Ранее: альманах «Компьютерные игры»</h3>";
if (magPref=='lki') {galRes += "<h3 class='linkB' onClick='showBookGal(7)'>Ранее: одноименная серия книг</h3>"; numfix+=13;}
if (magPref=='exe') {cl = maKeys.indexOf('mi'); galRes += "<h3 class='linkM' onClick='showGal("+cl+")'>Ранее: «Магазин Игрушек»</h3>"; numfix+=17;}
if (magPref=='mik') {cl = npKeys.indexOf('b_mik'); galRes += "<h3 class='linkN' onClick='showPaperGal("+cl+")'>Ранее: одноименная газета</h3>";}
for (let i=1; i<mags[mt].length; i++) {
	galArray = mags[mt][i].split('|');
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); fullYear = (pubYear > 90) ? "19"+pubYear : "20"+pubYear; galRes += "<h2><a onClick=showYear("+fullYear+")>"+fullYear+"</a></h2>";
		if ((issNum == '')&&(galArray[0].slice(2) != (i+numfix))) issNum = 'start'; 
				if ((i>42)&&(window.location.protocol != "file:")) lazyLoad = "loading='lazy'";
		}
	if (mags[mt][i].slice(3,6).indexOf("_|")>-1) numfix--; 
	if (issNum != '') issNum = "<div class='galIss'>"+(i+numfix)+"</div>";
	if (mags[mt][i].slice(3,5).indexOf("-")>-1) {numfix++; if (magPref=='mik' && (i==237||i==238)) numfix++;}
	if (magPref=='lki'||magPref=='mf'||(magPref=='im' && i>55)) galRes += getSiteLink (magPref,i)+galArray[0].slice(2)+"</a></div>";
		else if (magPref=='vr') galRes += generateLink(galArray[0],i);
		else galRes += getGalLink(magPref+galArray[0]);
	if (magPref=='xs') {if (galArray[1]=="*,-") {galRes += "<img id='m-"+mt+"-"+i+"' class='missing' src='cvs/"+magPref+galArray[0]+".jpg'></span>"; continue;}}
	galRes += issNum+"<img id='m-"+mt+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' "+lazyLoad+" onclick='showModal(this)'></span>";
	}
if (magPref=='pcr') galRes += "<br><br><br><h3 style='border-bottom: 3px #8e3ca2 solid' onClick='showDiscGal(0)'>Электронная версия журнала</h3>";
if (magPref=='bah') {cl = maKeys.indexOf('comp'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Позже: «КомпАс»</h3>";}
if (magPref=='mi') {cl = maKeys.indexOf('exe'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Позже переименован в «Game.EXE»</h3>";}
if (magPref=='gl') {cl = maKeys.indexOf('glsp'); cl2 = npKeys.indexOf('gpl'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Спецвыпуски</h3><h3 style='margin-left: 30px; border-bottom: 3px #b20f0b solid' onClick='showPDFGal(2)'>Неопубликованные материалы</h3><h3 class='linkN' style='margin-left: 30px' onClick='showPaperGal("+cl2+")'>Страна PC Игр</h3>";}
if (magPref=='glsp') {cl = maKeys.indexOf('gl'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски</h3>";}
if (magPref=='nim') {cl = maKeys.indexOf('nims'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Спецвыпуски</h3><h3  style='margin-left: 30px;' class='linkB' onClick='showBookGal(8)'>Энциклопедии</h3>";}
if (magPref=='nims') {cl = maKeys.indexOf('nim'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски</h3>";}
if (magPref=='mg') galRes += "<br><br><br><h3 style='border-bottom: 3px #b20f0b solid' onClick='showPDFGal(3)'>Гайды с дисковых приложений</h3>";
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
if ((window.location.protocol == "file:")&&(ms !== undefined)) document.getElementById("m-"+mt+"-"+ms).scrollIntoView(false); else window.scrollTo(0,0);
}

function showBookGal(mt) {
navState('book', {idx: mt});
let pubYear = '';
let galRes = "<div class='gal'><h1>"+books[mt][0]+"</h1>";
for (let i=1; i<books[mt].length; i++) {
	let bookID = books[mt][i].split("|")[0];
	let curYear = book_details[bookID].split("|")[3];
	if (curYear != pubYear) {pubYear = curYear; galRes += "<h2><a onClick=showYear("+pubYear+")>"+pubYear+"</a></h2>";}
	if (mt==4) {if (i==6 || i==11 || i==16) galRes += "<br><br>";} // Инфорком
	let bImg = "<img title='"+bookID+"' id='b-"+mt+"-"+i+"' src='cvs/b_"+bookID+".jpg' onclick='showModal(this)'>";
	if(!webLinks.hasOwnProperty(bookID)) galRes += bImg;
	else galRes += "<span><div class='galHint'><a href='https://archive.org/stream/"+webLinks[bookID].split("|")[0]+"#page/n0/mode/2up' target='_blank'>&#10148;</a></div>"+bImg+"</span>";
	}
if (mt==0) {cl = maKeys.indexOf('nim'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Позже: журнал «Навигатор игрового мира»</h3>";}
if (mt==7) {cl = maKeys.indexOf('lki'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Позже: одноименный журнал</h3>";}
if (mt==8) {cl = maKeys.indexOf('nim'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски журнала</h3>";}
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
window.scrollTo(0,0);
}

function showPaperGal(mt) {
navState('paper', {idx: mt});
let galArray = []; let cl = 0;
let pubYear = '', lazyLoad = '', numfix=0, fullYear;
let [papName, papPref] = papers[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+papName+"</h1>";
for (let i=1; i<papers[mt].length; i++) {
	galArray = papers[mt][i].split('|');
	let [yearNum, hardNum] = galArray[0].split("@");
	if (yearNum.slice(0,2) != pubYear) {pubYear = yearNum.slice(0,2); fullYear = (pubYear > 90) ? "19"+pubYear : "20"+pubYear; galRes += "<h2><a onClick=showYear("+fullYear+")>"+fullYear+"</a></h2>";}
	if (hardNum) {
		if (hardNum.length>3) hardNum = hardNum.substring(0, hardNum.indexOf("-"));
		issNum = "<div class='galIss'>"+hardNum+"</div>"; } 
	else {			
		if (papers[mt][i].slice(3,6).indexOf("_|")>-1) numfix--; 
		issNum = "<div class='galIss'>"+(i+numfix)+"</div>";
		if (papers[mt][i].slice(3,5).indexOf("-")>-1) numfix++;	}
	if ((i>42)&&(window.location.protocol != "file:")) lazyLoad = "loading='lazy'";	
	if (papPref=='vr') galRes += generateLink(yearNum,i);
	else galRes += getGalLink(papPref+yearNum,1);
	galRes += issNum+"<img id='n-"+mt+"-"+i+"' src='cvs/"+papPref+yearNum+".jpg' "+lazyLoad+" onclick='showModal(this)'></span>";
	}
if (papPref=='gpl') {cl = maKeys.indexOf('gl'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски журнала</h3>";}
if (papPref=='b_mik') {cl = maKeys.indexOf('mik'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Позже: одноименный журнал</h3>";}
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
window.scrollTo(0,0);
}

function showPDFGal(mt) {
navState('pdf', {idx: mt});
let galArray = [];
let pubYear = '';
let [magName, magPref, magURL] = PDFs[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
for (let i=1; i<PDFs[mt].length; i++) {
	galArray = PDFs[mt][i].split('|');
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); galRes += (pubYear > 90) ? "<h2>19"+pubYear+"</h2>" : "<h2>20"+pubYear+"</h2>";}	
	galRes += getGalLink(magPref+galArray[0])+"<img id='p-"+mt+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' onclick='showModal(this)'></span>";
	}
if (magURL) galRes += "<br><br><br><h3 style='border-bottom: 3px #800000 solid'><a href='http://"+magURL+"' target='_blank'>Сайт: "+magURL+"</a></h3>";
if (mt==2) {cl = maKeys.indexOf('gl'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски</h3>";}
if (mt==3) {cl = maKeys.indexOf('mg'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Регулярные выпуски</h3>";}
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
}

function showDiscGal(mt) {
navState('disc', {idx: mt});
let galArray = [];
let pubYear = '';
let [magName, magPref] = dis[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
for (let i=1; i<dis[mt].length; i++) {
	galArray = dis[mt][i].split('|');
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); galRes += "<h2>19"+pubYear+"</h2>";}
	galRes += "<img title='"+galArray[0]+"' id='d-"+mt+"-"+i+"' src='cvs/d_"+magPref+galArray[0]+".jpg' onclick='showModal(this)'>";
	}
if (mt==0) {cl = maKeys.indexOf('pcr'); galRes += "<br><br><br><h3 class='linkM' onClick='showGal("+cl+")'>Бумажная версия журнала</h3>";}
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
}

function showTVGal() {
navState('tv', {});
let galRes = "<div class='gal'><h1>Телепередачи</h1><h2>С Бонусом и Гамовером</h2>";
galRes += "<img title='От винта!' id='v-ov' src='cvs/tv_ov.jpg' style='cursor: pointer;' onclick='showModal(this)'>";
for (let i=0; i<tvs.length; i++) {
	let [tvName, tvPref] = tvs[i][0].split("|");
	galRes += "<img title='"+tvName+"' id='v-"+i+"' src='cvs/tv_"+tvPref+".jpg' style='cursor: pointer;' onclick='showModal(this)'>";
	}
hintBar.innerHTML = '';
prnt.innerHTML = galRes+"</div>";
}

function showMiscGal() {
navState('misc', {});
let allRes = "<div class='gal'><h1>Прочие журналы</h1>"; 
let galArray = []; let mt = 0;
for (let j in maMisc) {
	mt = maMisc[j];
	let [magName, magPref] = mags[mt][0].split("|");
	let galRes = "<h2>"+magName+"</h2>";
		for (let i=1; i<mags[mt].length; i++) {
			galArray = mags[mt][i].split('|'); 		
			galRes += getGalLink(magPref+galArray[0]);
			galRes += "<div class='galIss'>"+galArray[0].slice(0,2)+"</div><img id='m-"+mt+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' onclick='showModal(this)'></span>";
			if (i%9 == 0) galRes +="<br>"
		}
	allRes += galRes;
	}
prnt.innerHTML = allRes+"</div>";
hintBar.innerHTML = '';
}

window.prevMod = '';

function showModal(cov) {
modal.style.display = "flex";
let magGame = ''; let modRes = ''; let magArray = [];
let [mType,m1,m2] = cov.id.split("-");

if (mType == "b") {
modRes = "<img src='"+cov.src+"' onclick='showBookGal("+m1+")'>";
magArray = books[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#5d9d52";
}
else if (mType == "m") {
if (maMisc.indexOf(parseInt(m1))>-1) modRes = "<img src='"+cov.src+"' onclick='showMiscGal()'>"
else modRes = "<img src='"+cov.src+"' onclick='showGal("+m1+","+m2+")'>";
magArray = mags[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#345fb9";
}
else if (mType == "n") {
modRes = "<img src='"+cov.src+"' onclick='showPaperGal("+m1+")'>";
magArray = papers[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#0d96a4";
}
else if (mType == "d") {
modRes = "<img src='"+cov.src+"' onclick='showDiscGal("+m1+")'>";
magArray = dis[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#8e3ca2";
}
else if (mType == "p") {
modRes = "<img src='"+cov.src+"' onclick='showPDFGal("+m1+")'>";
magArray = PDFs[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#b20f0b";
}
else if (mType == "v") {
modRes = "<img src='"+cov.src+"' onclick='showTVGal()'>";
if (m1=='ov') {	let vidArray = []; for (let i=0; i<otvinta.length; i++) { vidArray = otvinta[i].split('|'); magArray.push.apply(magArray,vidArray[1].split('+')); }}
else for (let i=0; i<tvs[m1].length; i++) magArray.push.apply(magArray, tvs[m1][i].substring(0,tvs[m1][i].indexOf('|')).split('+'));
document.getElementById('modContent').style.borderColor = "fd8405";
}

let gamesArray = [...new Set(magArray.slice(1,magArray.length).map(x => x.replace(/,.+$/,"")))].sort();
modRes+="<select id='modSel' size='10'><option class='mobSelect' value='' disabled selected>Содержание номера</option>"
for (let j=0; j<gamesArray.length; j++) {
	magGame = gamesArray[j];
	if (magGame.indexOf("(") > -1) {magGame = magGame.replace(/ \(.*\)/ig, '').trim();}
	if (magGame.indexOf("'") > -1) {magGame = magGame.replace(/'/g, '^');}
	modRes+="<option value='"+magGame+"'>"+gamesArray[j]+"</option>"
	}
modRes+="</select>"
document.getElementById('modContent').style.height = cov.naturalHeight;
document.getElementById('modContent').innerHTML = modRes;
document.getElementById('modSel').style.height = cov.naturalHeight;
if (cov.id != prevMod) document.getElementById('modSel').scrollTop = 0;
prevMod = cov.id;
let timeout = null;
let modalSel = document.getElementById("modSel");
modalSel.onchange = function (e) {clearTimeout(timeout); timeout = setTimeout(function () {let fVal = modalSel.value.replace(/\^/g, '\''); wrapper(fVal+'='); sInp.value = fVal;}, 100)};
}

let modal = document.getElementById("covModal");
window.onclick = function (event) {if (event.target == modal) {
modal.style.display = "none"; 
}}

function prntMsg() {
showYear();
prnt.innerHTML = "<div class='infMsg'>Приветствую вас на страницах путеводителя по игрожуру девяностых! <h1>О проекте</h1>Как-то раз, запустив очередную старую игру, я захотел перечитать ее обзоры в бумажной прессе тех лет. Обложился книгами и журналами, потратил кучу времени на листание с перекладыванием и понял, что надо менять подход. Если нет поисковика по игровой прессе, остается только сделать его самому. Взял и сделал на чистом JavaScript. Подробности на <a href='https://dtf.ru/retro/75296' target='_blank'>DTF</a>. Приложение не требует интернета для работы, на GitHub всегда доступна <a href='https://github.com/retroindex/retroindex.github.io/archive/master.zip'>актуальная версия</a> для локального использования. <h1>Поисковые запросы</h1><p>Наберите в строке поиска небольшие части слов из названия интересующей игры (morr, ret kr, слон). Пробел перед порядковым номером игры необязателен (gob2). Для удобства пользуйтесь клавишами Enter и Escape, или вовсе включите автопоиск. Последний избавит от лишних кликов, начиная обрабатывать запрос через полсекунды после набора текста. Если части слов не находятся, делается предположение, что набрана аббревиатура (lba, mm6). Текст обрезается до 5 символов, разбивается пробелами и ищется повторно. Символ <b>=</b> в любом месте поискового запроса позволит найти строгое совпадение без лишних результатов (gothic). <h1>Результаты поиска</h1><p>В выдаче формируется адаптивная сетка из 6 категорий: журналы, книги, газеты, дискмаги, сетевые журналы и телепередачи. Внутри категорий закладки отсортированы по старшинству изданий, нажатие кнопки &#8645; устанавливает глобальную сортировку по дате без повторного поиска. Клик по обложке открывает модальное окно с оглавлением, из которого можно перейти как к галерее номеров данного издания, так и к новой выдаче по игре из оглавления. Закрывается окно кликом в любом месте за его пределами, либо клавишей Escape. <h1>Панель подсказок</h1>Постоянный рост объема базы со временем привел к затруднению восприятия смешанных результатов поиска. Проблема решилась добавлением вспомогательной панели для отображения алфавитно упорядоченного списка найденных игр (имеющих не менее двух обзоров). Панель также используется для машины времени и возможного размещения пунктов меню в дальнейших обновлениях. Клавишей Escape сбрасывается к исходному состоянию.<h1>Привязка к Archive.org</h1>Некоторые \"закладки\" в выдаче привязаны к крупнейшему интернет архиву и если дернуть за веревочку, журнал откроется на нужной странице. <p><img src='misc/h_linked.png'><p>Любительские сканы и редакционные пдфки часто вносят путаницу в нумерацию — отсутствующие страницы с рекламой, \"лишние\" страницы, перепутанные местами итд. Из-за всех этих нюансов, которые приходится учитывать, связующие записи в <a href='links.js' target='_blank'>links.js</a> выглядят примерно так: <p><b>\"exe012\":\"Game.EXE_02_2001|2|38,-80,-80,91\"</b> <p>Здесь по порядку: <br>Сопоставление идентификатора в базе и на Archive.org; <br>Cмещение нумерации (0 - нумеруется с обложки, 2 - c третьей страницы); <br>38 и 91 - отсутствующие страницы, счетчик сдвигается влево; <br>-80,-80 - две лишних страницы подряд, счетчик сдвигается вправо. <p>Нередко на центральный разворот журнала ставили постер со сквозной нумерацией, в таком случае после смещения указывается <b>p</b> + первая страница постера (например, <b>p73</b>). Для проверки целостности нумерации журналов был создан специальный инструмент - <a href='tools/pagecheck.htm' target='_blank'>PageChecker</a><p>На вопрос об отсутствии в Архиве большинства журналов 21 века, могу сказать, что в принципе ничего туда не загружаю и даже не имею аккаунта. <h1>Прямые ссылки</h1>Не уверен, делают ли так с JavaScript, или это очередной мой велосипед, но предусмотрел возможность публикации ссылок на поисковые запросы. Для этого в адресную строку дописывается <b>#</b> с последующим кратким названием игры. В названии допускается кириллица и пробелы, которые для читаемости лучше заменять нижним прочерком. Некоторые форумные движки требуют наличия слэша перед хешем: <a href='https://retroindex.github.io/#homm2' target='_blank'>retroindex.github.io/#homm2</a>. <p>Также можно ссылаться на галереи по журналам и годам, указав вместо игры зарезервированный никнейм журнала (см. <a href='links.js' target='_blank'>links.js</a>), или четырехзначный год. <h1>Галереи изданий</h1>В меню справа от поиска можно выбрать категорию и открыть галерею интересующего издания. При этом в списке журналов указывается их фактическое количество, по понятным причинам не всегда совпадающее с последним номером. В галерее клик по году открывает галерею изданий за этот год, откуда можно аналогично перейти к существующим на тот момент изданиям. <p><img src='misc/h_num.jpg' style='float: left; padding-right: 1em;'>При наведении курсора на обложку журнала появляется угловой оверлей с текущим номером и центральный со сквозным номером (если он отличается от текущего). Сквозной номер вычисляется на основе счетчика и корректирующих символов -_ в названии файла. <p>nim982.jpg : +0<br>nim982-3.jpg : +1<br>nim982_3.jpg : +0<br>nim982_.jpg : -1 <p>При наличии привязки к Архиву, угловой оверлей имеет зеленый фон и открывает журнал по клику. Для ряда изданий, не размещенных на Archive.org, но имеющих собственные официальные архивы номеров, установлена автоматическая привязка к соответствующим сайтам.<p>Что до самих обложек, в их изготовлении используется ряд хитростей. Ширина обложки всегда равна 128px (учитывается кратность 8 для JPEG и размещение ряда из 12 обложек в разрешении 1600x1200), а высота как получится, но всегда одинаковая в рамках одного года издания. Важно получить четкую незамыленную картинку, тут HighPass макрос в помощь. Для преобразования в JPEG отлично зарекомендовал себя гугловский кодер Guetzli, обеспечивающий лучшее качество при меньшем размере, ценой длительных вычислений. К крупным изображениям он обычно неприменим, а для таких — в самый раз. <h1>Структура базы</h1>База представляет собой \"человекочитаемый\" и легко редактируемый многомерный массив, записанный в набор CSV-подобных файлов (mags.js, books.js, papers.js, digital.js, tv.js). Лишней, или дублирующейся информации в ней практически нет, за исключением названий игр. Но благодаря использованию Gzip на стороне Github, объем загружаемой базы уменьшается в 4 раза (до ~500 килобайт). В скобках после названия игры может указываться разнообразная информация: <br>- альтернативное (раннее, или переводное) название игры; <br>- указание на обзор всей игровой серии (series), или мода (mod); <br>- интервью с разработчиками игры. <h1>Обратная связь</h1>Присылайте багрепорты и пожелания. Если вы располагаете отсутствующими в базе изданиями и готовы сфотографировать обложку с оглавлением, буду рад добавить их. <p><a href='https://www.old-games.ru/forum/threads/88160/' target='_blank'>Официальная тема на форуме OG</a><br><a href='https://www.old-games.ru/forum/threads/31874/' target='_blank'>Журнальная тема (сканирование)</a><br><a href='https://discord.gg/AejRAnDvUj' target='_blank'>Сервер Discord</a> <p align='right'>Morendil</p></div>";
window.scrollTo(0,0);
}

function sortTabs() {
let items = document.querySelectorAll('.dtab');
if (!sBtn.style.color) {for (var i = 0; i < items.length; i++) items[i].removeAttribute("style"); return;}
Array.from(items).sort(function(a, b) {a = a.getAttribute('data-pub'); b = b.getAttribute('data-pub'); return a - b;}).forEach(function(n, i) {n.style.order = i})
}

function showYear(year) {
if (year) navState('year', {year});
let galArray = [];
let rty = 2018;
let lazyLoad = ''; if (window.location.protocol != "file:") lazyLoad = "loading='lazy'";
if(year) {
let cur = Number(year); let galRes = "<div class='gal'><h1>";
galRes += (cur<1995) ? "<span>&nbsp;</span>" : "<span class='ns' onclick='showYear("+(cur-1)+")'>◄</span>"; galRes += cur;
galRes += (cur>=rty) ? "<span>&nbsp;</span>" : "<span class='ns' onclick='showYear("+(cur+1)+")'>►</span></h1>";
for (let g=0; g<mags.length; g++) {
let [magName, magPref, magType] = mags[g][0].split("|"); let noTitle = true; let items = 0;
if (magType == 1) continue;
for (let i=1; i<mags[g].length && items<12; i++) {
if (mags[g][i].slice(0,2) == String(year).slice(2)) {
	if (noTitle) {
		galRes += "<h2><a onclick='showGal("+g+")'>"+magName+"</a></h2>"; noTitle = false; 
		if (g>48) lazyLoad = "loading='lazy'";}
	galArray = mags[g][i].split('|'); items++;
	if (magPref=='lki'||magPref=='mf'||(magPref=='im' && i>55)) galRes += getSiteLink (magPref,i)+galArray[0].slice(2)+"</a></div>"; 
		else if (magPref=='vr') galRes += generateLink(galArray[0],i); 
		else galRes += getGalLink(magPref+galArray[0]);
	if (magPref=='xs') {if (galArray[1]=="*,-") {galRes += "<img id='m-"+g+"-"+i+"' class='missing' src='cvs/"+magPref+galArray[0]+".jpg'></span>"; continue;}}
	if ((magPref=='gl'||magPref=='mik') && year<2011 && items==12) galRes+='<div class="galIss" style="display: block; font-size: 100px; color: rgba(255,255,255,0.5);">+</div>';
	galRes += "<img id='m-"+g+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' onclick='showModal(this)' "+lazyLoad+"></span>";
}}}	
for (let g=0; g<books.length; g++) {
let noTitle = true;
for (let i=1; i<books[g].length; i++) {
let bookID = books[g][i].split("|")[0];
if (bookID == "cdr1") break;	// Обрезка длинных серий
if (book_details[bookID].split("|")[3] == year) {
	if (noTitle) {galRes += "<h2><a onclick='showBookGal("+g+")'>"+books[g][0]+"</a></h2>"; noTitle = false;}
	let bImg = "<img title='"+bookID+"' id='b-"+g+"-"+i+"' src='cvs/b_"+bookID+".jpg' loading='lazy' onclick='showModal(this)'>";
	if(!webLinks.hasOwnProperty(bookID)) galRes += bImg;
	else galRes += "<span><div class='galHint'><a href='https://archive.org/stream/"+webLinks[bookID].split("|")[0]+"#page/n0/mode/2up' target='_blank'>&#10148;</a></div>"+bImg+"</span>";
}}}
prnt.innerHTML = galRes+"</div>";
window.scrollTo(0,0);
}
let yearBuffer = ''; let cty = 1994;
while (cty<=rty) {
if (cty == year) yearBuffer += '<span style="background-color: #fdbc00; color: #000;">'+cty+'</span>&nbsp;'; 
else yearBuffer += '<span onClick="showYear('+cty+')">'+cty+'</span>&nbsp;'; cty++; }
hintBar.innerHTML = '<center>'+yearBuffer+'</center>';
}

function toggleTheme() {const isDark = document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', isDark ? 'dark' : 'light');}
document.getElementById('chAuto').addEventListener('change', () => {localStorage.setItem("autosearch", document.getElementById('chAuto').checked.toString())})
if (localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark-mode'); }
if (localStorage.getItem('autosearch') === 'false') { document.getElementById('chAuto').checked = false; }

function renderHomeStats() {
const s = (val, txt) => `<div style="background: var(--panel); padding: 8px 4px; border-radius: 10px; border: 1px solid var(--border); flex: 1 1 21%; min-width: 90px; max-width: 24%; text-align: center; box-sizing: border-box;">
<div style="font-size: 15px; font-weight: bold; color: var(--h2);">${val}</div><div style="font-size: 12px; text-transform: uppercase; color: var(--text); opacity: 0.6;">${txt}</div></div>`;
let rndG = showcase[Math.floor(Math.random() * showcase.length)];
let mIdx = Math.floor(Math.random() * mags.length); let mIss = Math.floor(Math.random() * (mags[mIdx].length - 1)) + 1; let [mName, mPref] = mags[mIdx][0].split('|'); let mFile = mags[mIdx][mIss].split('|')[0];
document.getElementById('prnt').innerHTML = 
	`<div style="height: 50vh; display: flex; align-items: center;"><div style="text-align: center"><h1>Ваш путеводитель <nobr>по игрожуру 90-х</nobr></h1>
	<img class="sar" src="misc/sarth.png"><h2>Поиск и каталог обзоров старых игр для IBM&nbsp;PC</h2></div></div>
	<div style="flex-basis: 100%; height: 0;"></div><div class="homeStats">
    <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; width:100%; max-width:800px;">` +
    s(Gstat.articles, 'Обзоров') + s(Gstat.games, 'Игр') + s(Gstat.mags, 'Журналов') + s(Gstat.books, 'Книг') + s(Gstat.papers, 'Газет') + s(Gstat.dmag, 'Дискмагов') + s(Gstat.dpdf, 'PDF-журналов') + 
	`</div><div style="flex-basis: 100%; height: 0;"></div><div style="display:flex; gap:10px; width:100%; max-width:800px; margin-top:10px; flex-wrap: wrap;">
    <div class="infMsg ns" style="flex: 1 1 300px; margin:0; padding:10px; display:flex; align-items:center; gap:12px; min-width:150px; box-sizing: border-box; background: var(--panel); color: var(--text);" onclick="showGal(${mIdx})">
    <img src="cvs/${mPref}${mFile}.jpg" style="width:64px; border-radius:3px; box-shadow: 2px 2px 5px rgba(0,0,0,0.2)">
    <div style="width: 100%; text-align: center;"><small style="color:var(--text); position: relative;  font-size:12px;">СЛУЧАЙНОЕ ИЗДАНИЕ</small><br><b style="font-size:14px">${mName}</b></div></div>
    <div class="infMsg ns" style="flex: 1 1 300px; margin:0; padding:10px; display:flex; align-items:center; gap:12px; min-width:280px; box-sizing: border-box; background: var(--panel); color: var(--text);" onclick="wrapper('${rndG}=')">
    <div style="width: 100%; text-align: center;"><small style="color:var(--text); font-size:12px;">СЛУЧАЙНАЯ ИГРА</small><br><b style="font-size:14px">${rndG}</b></div></div></div></div>`; }
if (stdLoad) renderHomeStats();

var YF = '';
function tabsYearFilter(curBar, sYear) {
if (sYear == YF) {resetYF(); return;}
let items = document.querySelectorAll('.dtab'); YF = sYear;
for (let i=0; i<items.length-4; i++) { if (items[i].getAttribute('data-pub').substr(0,4) != sYear)	items[i].style.display="none"; else items[i].style.display="block"; }}

function resetYF() { let items = document.querySelectorAll('.dtab'); for (let i=0; i<items.length-4; i++) {if (items[i].style.display=="none") items[i].style.display="block"} YF = ''; }

</script>
</body>
</html>