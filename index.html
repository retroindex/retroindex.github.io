<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link type="image/png" sizes="16x16" rel="icon" href="misc/favicon.png">
<link type="image/png" sizes="192x192" rel="icon" href="misc/favicon-192x192.png">
<link rel="manifest" href="misc/manifest.json">
<meta name="theme-color" content="#e9e3cc">
<meta name="viewport" content="width=450">
<meta name="author" content="Morendil">
<meta name="description"  content="Ваш путеводитель по игрожуру 90х — поиск и каталог обзоров старых игр для IBM PC">
<title>Retroindex</title>
<style>
HTML {overflow-y: scroll;}
BODY {background: #e9e3cc url(misc/paper.jpg) scroll; margin: 0;}
H1,H2,H3 {font-family: Arial;}
H2 {color: #800000;}
H2 A:hover{color: #b20f0b; cursor: pointer;}
H3 {color: #800000; display: inline; padding-bottom: 2px;}
H3:hover {color: #b20f0b; cursor: pointer;}
H3 A {text-decoration: none;}
TD A {display: block; width: 100%; padding: 15px 0; text-align: right; outline: none;}
P {margin-bottom: 0;}
@font-face {font-family: 'Antnum'; src: url('misc/antnum.woff2') format('woff2');}
#sInp {padding: 0 10px 0 36px; width: 250px; height: 32px; margin-right: 0; border-radius: 15px 0 0 15px; font-size:15px; outline: none; border: 0; background-color: #f4efda; box-shadow: inset 1px 2px 1px rgba(0,0,0,0.3); transition: background-color .3s ease-out;}
#sInp:focus {background-color: #fff;}
#sBut {height: 32px; margin-left: 0; border-radius: 0 15px 15px 0; font-size:15px; border: 1px #4c270e solid; background-color: #f4efda; outline: none;}
#sel {height: 25px; margin-right: 0; font-size:14px; outline: none; border: 0; background-color: #f4efda;}
#prnt {display: flex; flex-wrap: wrap; justify-content: center;} 
#chAuto {border: 1px #4c270e solid; background-color: #f4efda; border-radius: 15px;}
#modSel option:nth-child(2n) {background-color: #f0f5ff;}
#modSel {flex-basis: 292px; flex-grow: 1;}
.topBar {height: 45px; background-color: #e9e3cc; background: url(misc/paper.jpg); text-align: center; position: sticky; top: 0; padding: 0 15px 0 8px; display: flex; margin: 0; align-items: center; z-index: 100;}
.topRex {display: none;}
.topCenter {flex: 1 0 0; white-space: nowrap; height: 100%;}
.dtab {flex: 1 0 0; min-width: 400px; max-width: 600px; margin: 12px;}
.tRes {background-color: rgba(99,99,99,0.1); width: 100%; font: 14px Arial; border-collapse: collapse; text-align: center;}
.tRes TH {font-weight: normal; margin: 0; color: #fff;}
.colM TH {background-color: #345fb9;}
.colB TH {background-color: #5d9d52;}
.colD TH {background-color: #8e3ca2;}
.colP TH {background-color: #b20f0b;}
.colV TH {background-color: #fd8405;}
.gal {text-align: center; padding-bottom: 40px; max-width: 1800px;}
.gal img {padding: 0; min-height: 128px;}
.gal span:hover div {display: block;}
.gal span {position: relative; display: inline-block; width: 128px; cursor: help;}
.galHint {display: none; position: absolute; bottom: 0; left: 0; padding: 3px; min-width: 30px; background-color: rgba(0, 128, 0, 0.7); color: #fff; font: bold 16px Arial; z-index: 2; border-radius: 0 5px 0 0;}
.galHint a {color: white; text-decoration: none; display: inline-block; width: 100%;}
.galIss {display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(0,0,0,0.5); text-shadow: 0px 0px 10px rgba(255,255,255,0.9); pointer-events: none; font-size: 60px; font-family: Impact, Antnum, sans-serif; z-index: 2;}
.cov {width: 64px; cursor: pointer;}
.mobSelect {display: none;}
.tRes TH:nth-child(1) {width: 64px;}
.tRes TH:nth-child(2) {height: 25px; white-space: nowrap; border-right: 1px solid #d2cdbc;}
.tRes TH:nth-child(3) {border-top-right-radius: 4px; width: 36px;}
.tRes TH, TD {padding: 0;}
.flexFix {height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0;}
.errMsg {background-color: #f883a2; max-width: 400px; padding: 15px; margin-top: 30px; border-radius: 15px; font: 14px Arial;}
.infMsg {background-color: #b4d055; min-width: 400px; width: 60vw; padding: 15px; margin-top: 30px; border-radius: 15px; font: 14px Arial;}
.cb {position: relative; left: 31px; top: 9px;}
.sar {border-radius: 15px;}
.ns {user-select: none; cursor: pointer !important;}
.mc {font-size: 12px; opacity: 0.4; float: right;}
#chAuto {display: none;}
#chAuto + label:before {display: inline-block; cursor: pointer; height: 28px; width: 28px; content: ""; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAVFBMVEX////49/b29PPx7uzq5uPi3Njb1M/Uy8XNw7zGurK+sai3qZ+woJWunpKpmIyij4KbhniUfW6NdWWGbFt/ZFJ3W0hwUj5pSjViQStbOSJTLxdMJw6AJr+6AAAAAXRSTlMAQObYZgAAAghJREFUeNqU1OsSqygUhNFmFFTJeIsi8r3/e54Klcx4NEmZ9RPZQndZ6uwf/69+tFHrurLzsiSj6waCWmb9wIGduOmgSb3RJ4E+YvUXMwCTPunYYHXaKQPbQqdPChg22N2jTYRypdJR3yrTzL2c/z/ITDCbkqSjG8kpa0hGHdzzOXYFUufPJdqUXgebhJdsocytqakjnKMMDHoZY7tvy+bLnaOE51JZS4VO6jdRAl4PnlZvDLsoRspGopFkzl0+E3XK3LB1/8Un1sYtzHrLFJJcH4GgJ0+2lZ8/8QCwLJR6qldgtfokAhGvel+3ba0+65nKglkVsy5y9FIgpusjWjdXpTmSal3lAQbjcnfO+36cQlj01QBrqYyXqO9Kt6vvPvbeV05X+Y3UG/3EdIntpquqHKh4RGv1VdGWymJSZidYrL5oIN5vTiWz7G0cl7Am8Pqi3XhIgU6el1Zfle24AtSqxtH72lldUTQbRr8xBP2oZtBO4Zw+MOVrj6926SZga/RGHSB6HZURtvi2aU826iCQblJLsm/+vl52Pr2tea7c6XTQkxPPbPrLwKKH8Xz+iM/Bwelpv9Vs9JKaMEmyIeRHzHpYDyMtqyRNYHPgIMnB7s4FFNozK3NVLzDoOKIZBlstjOeSH0adR4rAw2J0YPoQ5kZvRmSGSOyMPtuPXOb5M/poAQPqaQEAEhEuCu707rIAAAAASUVORK5CYII=); background-size: contain;}
#chAuto:checked + label:before {display: inline-block; cursor: pointer; height: 28px; width: 28px; content: ""; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAVFBMVEX////49/b29PPx7uzq5uPi3Njb1M/Uy8XNw7zGurK+sai3qZ+woJWunpKpmIyij4KbhniUfW6NdWWGbFt/ZFJ3W0hwUj5pSjViQStbOSJTLxdMJw6AJr+6AAAAAXRSTlMAQObYZgAAAi1JREFUeNqUlImyojAURG8GEpA4bEK28///OQUV3/ASfctx19t0usu6UvPH/pVfEunl57SjFU1Sv5DMOBnY5BcY0Ct3Kbil6b2xYwpo+YSagVXeMRLBm0/5HHFnlHc0MEe4nGNIuNbTSck05Dcbj3b7b6RW2FRLkpI7yeSkR8UjPE4f7YE02rpEndLTWCWsiG5ygz7d+gB1lJlZnixhuLalz8PVUVz+qu1FGqnoSVJLrBxYBnnBfInyrHIhHG9V3WVONOY3cxw/4hN6ZfayGMiXbo75KQBOMpaT2FaSTDs6gH3nY6T3gNelAskEIGClv9ath0JwNZGJtW3YpCvP/l5imEQcIf1cIj6aLm2B1EtNEeVa0KzM2Z2xdlpW5/ZaIhdm8LktnoSvJdKaS32PZbK2M+UsyGtspFwGUEYpUGMi3uvcbxTdGag5og1XTS1phpw9JDnRK+z6alNKbhAedyMtm+j7suzOJ7BXmzLKEDlIjlEsT4ZCUu7rYfEAvXTLYm1vdNHZ676aW0TJa95IROHkl5Ke+ZOrMe/+Lap9ztjukm4F4u2VpHcQrJS0AWIAKxWWk0UKHOkuMpD0i+1rRW/V1W75m0e9fSfOxBuxXIi7HCy1/4I9g4ORK3lURabD060iop07f8obwheSAX+8rKDPwMewgcuZG2jkivJsXb/DLKVENph1t7PUJecmK0njONiVFKjJue0mLySi5kAY/w1XcsTUggCDQgsYUE8LABacNVGE1b6XAAAAAElFTkSuQmCC); background-size: contain;}
#covModal {display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.5); z-index: 150; align-items: center; justify-content: center;}
#modContent {background: #e9e3cc url(misc/paper.jpg); border-radius: 15px; padding: 10px; border: 3px solid #345fb9; width: 450px; z-index: 20; display: flex; align-items: flex-start;}
nav {white-space: nowrap;}
nav ul {padding:0; margin:0; list-style: none; position: relative;}
nav ul li {margin: 0; display:inline-block; background-color: #f4efda;}
nav a {display:block; text-align: left; padding:0 5px; color:#000; font: 15px Arial; line-height: 30px; text-decoration:none; cursor: pointer; border-top: 1px #ccc dotted;}
li:nth-child(21) a {border-top: 1px #345fb9 dotted;}
nav a:hover {background-color: #b20f0b; color: #fff;}
nav ul ul {display: none; position: absolute; top: 100%; left: 0;}
nav ul li:hover > ul {display:inherit;}
nav ul ul li {min-width:265px; display:list-item; position: relative;}
.ulM a {border-left: 3px #345fb9 solid;}
.ulB a {border-left: 3px #5d9d52 solid;}
.ulD a {border-left: 3px #8e3ca2 solid;}
.ulP a {border-left: 3px #b20f0b solid;}
.ulV a {border-left: 3px #fd8405 solid;}
.linkM {border-bottom: 3px #345fb9 solid;}
.linkB {border-bottom: 3px #5d9d52 solid;}
.missing {filter: saturate(0); opacity:0.5;}
.missing:hover {filter: saturate(1); opacity:1; cursor: default;}
IMG[id^="b-"] {cursor: help;}

@media (max-width: 840px) { 
.topLeft {display: none;}
.topRex {display: block;}
}
@media (max-width: 600px) { 
.topBar {border-bottom: 0;}
#covModal {align-items: flex-end; height: fill-available; height: -webkit-fill-available;}
#modContent {border-radius: 0; border-width: 5px 0 0 0; padding:0; width: 100vw;}
#modSel {flex-grow: 1;}
.mobSelect {display: block;}
.dtab {margin: 0;}
.topBar {margin-bottom: 12px;}
.topRight {display: none;}
.cov {width: 80px;}
.tRes {background-color: rgba(127,127,127,0.1);}
.tRes TH:nth-child(3) {border-top-right-radius: 0;} 
.infMsg {max-width: 430px;}
}
</style>
<script src="tv.js?ver=19a12"></script>
<script src="mags.js?ver=20701"></script>
<script src="books.js?ver=20608"></script>
<script src="digital.js?ver=20701"></script>
<script src="links.js?ver=20701"></script>
</head>
<body> 
<div class="topBar">
<div class="topRex"><img src="misc/rex.png" width="65" height="30"></div>
<div class="topLeft"><a href="https://retroindex.github.io"><img src="misc/retrologo.png" width="197" height="30"></a></div>
<div class="topCenter"><span class="cb"><input type="checkbox" id="chAuto"><label for="chAuto"></label></span><input type="search" id="sInp" autocomplete="off"><input type="button" id="sBut" class="mBut" value="Поиск" onclick="wrapper(sInp.value.trim())"></div>
<div class="topRight" id="topRightCnt"></div>
</div>
<div id="prnt"><div style="height: 90vh; display: flex; align-items: center;"><div style="text-align: center"><h1>Ваш путеводитель по&nbspигрожуру&nbsp90-х</h1><img class="sar" src="misc/sarth.png"><h2>Поиск и каталог обзоров старых игр для IBM&nbsp;PC</h2></div></div></div>
<div id="covModal"><div id="modContent"></div></div>								
<div style="opacity: 0; font-size: 1px; font-family: Impact, Antnum;">2019</div>
<script type="text/javascript">
if (window.location.hash) {
let sHash = window.location.hash.substring(1);
history.pushState(null, null, ' ');
if (hashTags.hasOwnProperty(sHash)) showGal(hashTags[sHash]);
else if ((/^(199|200)\d$/.test(sHash))) showYear(Number(sHash));
else {
if (sHash.indexOf('%')>=0) sHash = decodeURI(sHash); 
sHash = sHash.replace('_',' '); sInp.value = sHash;
wrapper(sHash);
}}

let timeout = null;	// debounce
sInp.onkeyup = function (e) {if (chAuto.checked) {clearTimeout(timeout); timeout = setTimeout(function () {wrapper(sInp.value.trim())}, 500)}};

document.addEventListener('keyup', function(event) {if (event.key == 'Enter' && sInp.value != '') wrapper(sInp.value.trim())});
document.addEventListener('keydown', function(event) {if (event.key == 'Escape') sInp.value='';});
window.addEventListener('hashchange', function() {location.reload();}, false);

function wrapper(wReg) {
let triedAbbr = false;
wReg = wReg.replace(/[*+,|?{}\[\]\(\)\\]/g, '');
if (document.getElementById('sel')) document.getElementById('sel').value="";

if (!globalSearch(wReg)) {
	if (!triedAbbr) {
		triedAbbr = true;
		if (wReg.length < 2) {prnt.innerHTML = ''; return;}
		wReg = wReg.replace(/\s+/g, '').substr(0,5).split("").join(" ");
		if (!globalSearch(wReg)) prnt.innerHTML = '<div class="errMsg">Подстроки и аббревиатура "<b>'+wReg+'</b>" не найдены.<br>Возможно, игра вышла позже 2009 года, или не на PC.</div>';
		}
	}
}

function globalSearch(sReg) {
	const start = new Date().getTime();
let re = "";
if (/^(of?)?\s*(t|th|the)?$/i.test(sReg)) return;
if (/(^|\s)[^0-9 .'-]{2,}\d+$/i.test(sReg)) sReg = sReg.replace(/\d+$/,' $&');
if (sReg.length<3 || sReg.indexOf('=')>=0) re = new RegExp("(^|\\|)"+sReg.replace('=','')+"( \\(.+\\))*($|,)","i")
	else {
	let sRegArray = sReg.split(/\s+/);
	let reString = "(^|\\||«|\\(|\\s+)"+sRegArray[0];
	if (sRegArray.length>1) for (let i=1; i<sRegArray.length; i++) reString += "[^,]*(«|\\(|\\s+)"+sRegArray[i]; 
	reString = reString.replace(/\./g, '\\.');
	re = new RegExp(reString,"i");
	}

///// Книги

let bookRes = "";
let bookArray = [];
for (let g=0; g<books.length; g++) {
	for (let i=1; i<books[g].length; i++) {
		if (re.test(books[g][i])) {
			bookArray = books[g][i].split('|');
			let [bName,bISBN,bPub,bYear,bQty] = book_details[bookArray[0]].split("|");
			for (let j=1; j<bookArray.length; j++) {
				let [bGame, bPage] = bookArray[j].split(",");
				if (re.test(bookArray[j])) bookRes += "<div class='dtab'><table class='tRes colB'><tr><th rowspan=2><img class='cov' id='b-"+g+"-"+i+"' src='cvs/b_"+bookArray[0]+".jpg' onclick='showModal(this)'></th><th>"+bGame+"</th><th>"+bPage+"</th></tr><tr><td>"+bName+"<br>Издательство "+bPub+", "+bYear+"<br>ISBN: "+bISBN+"</td><td>*</td></tr></table></div>"
			}
		}
	}
 }	
	
///// Журналы

let magRes = "";
let magArray = [];
for (let g=0; g<mags.length; g++) {
	let numfix=0;
	if (g==8) numfix+=17;	// EXE
	if (g==14) numfix+=13;  // ЛКИ
	for (let i=1; i<mags[g].length; i++) {
		if (mags[g][i].slice(3,5).indexOf("-")>-1){ numfix++; if (g==11 && (i==237||i==238)) numfix++;}
		if (mags[g][i].slice(3,6).indexOf("_|")>-1) numfix--;
		if (re.test(mags[g][i])) {
			magArray = mags[g][i].split('|');
			let [magName, magPref] = mags[g][0].split("|");
			let magNum = magArray[0];
			if (magNum.indexOf('_')>-1) {magNum = (magNum.slice(-1)=='_') ? magNum.replace('_','') : magNum.replace('_','-');}			
			magName += " №"+magNum.slice(2);
			if ((magNum.slice(2) != (i+numfix)) && (magNum.slice(3).indexOf("-")<0)) magName += " ("+(i+numfix)+")";				
			magName += "’"+magNum.slice(0,2);
			for (let j=1; j<magArray.length; j++) {
				let [magGame, magPage] = magArray[j].split(",");
				if (re.test(magArray[j])) magRes += "<div class='dtab'><table class='tRes colM'><tr><th rowspan=2><img class='cov' id='m-"+g+"-"+i+"' src='cvs/"+magPref+magArray[0]+".jpg' onclick='showModal(this)'></th><th>"+magGame+"</th><th>"+magPage+"</th></tr><tr><td id='"+magPref+magArray[0]+"'>"+magName+"</td><td>"+getLink(magPref+magArray[0],magPage)+"</td></tr></table></div>";
			}
		}
	}
 }

///// Дискмаги

let discRes = "";
let discArray = [];
let dType = "misc/fd.png";
let cds = "";
for (let g=0; g<dis.length; g++) {
	let numfix=0;
	if (g>1) {dType = 'misc/cd.png'; cds = "style='padding-top: 25px'"}
	for (let i=1; i<dis[g].length; i++) {
		discArray = dis[g][i].split('|');
		let [discName, discPref] = dis[g][0].split("|");
		discName += " №"+discArray[0].slice(2);
		if (discArray[0].slice(2).indexOf("-")>0) numfix++;
		else if ((discArray[0].slice(2) != (i+numfix)) && (g!=1)) discName += " ("+(i+numfix)+")";
		discName += "’"+discArray[0].slice(0,2);
		for (let j=1; j<discArray.length; j++) {
			if (re.test(discArray[j])) discRes += "<div class='dtab'><table class='tRes colD'><tr><th rowspan=2><img class='cov' id='d-"+g+"-"+i+"' src='cvs/d_"+discPref+discArray[0]+".jpg'"+cds+" onclick='showModal(this)'></th><th>"+discArray[j]+"</th><th><img src='"+dType+"'></th></tr><tr><td>"+discName+"</td><td>*</td></tr></table></div>";
		}
	}
 }

///// PDF

let PDFRes = "";
let PDFArray = [];
let exNum = ['glu','ox'];
for (let g=0; g<PDFs.length; g++) {
	for (let i=1; i<PDFs[g].length; i++) {
		if (re.test(PDFs[g][i])) {
			PDFArray = PDFs[g][i].split('|');
			let [PDFName,PDFPref] = PDFs[g][0].split("|");
			PDFName += " №"+PDFArray[0].slice(2);
			if ((PDFArray[0].slice(2) != i) && exNum.indexOf(PDFPref) < 0) PDFName += " ("+i+")";
			PDFName += "’"+PDFArray[0].slice(0,2);
			for (let j=1; j<PDFArray.length; j++) {
				let [PDFGame, PDFPage] = PDFArray[j].split(",");
				if (re.test(PDFArray[j])) PDFRes += "<div class='dtab'><table class='tRes colP'><tr><th rowspan=2><img class='cov' id='p-"+g+"-"+i+"' src='cvs/"+PDFPref+PDFArray[0]+".jpg' onclick='showModal(this)'></th><th>"+PDFGame+"</th><th>"+PDFPage+"</th></tr><tr><td id='"+PDFPref+PDFArray[0]+"'>"+PDFName+"</td><td>"+getLink(PDFPref+PDFArray[0],PDFPage)+"</td></tr></table></div>";
			}
		}
	}
 }	
	
///// ТВ
	
let vidArray = [];
let vidGames = [];
let vidRes = "";
for (let i=0; i<otvinta.length; i++) {
vidArray = otvinta[i].split('|');
vidGames = vidArray[1].split('+');  
for (let j=0; j<vidGames.length; j++) if (re.test(vidGames[j])) {
	vidRes += "<div class='dtab'><table class='tRes colV'><tr><th rowspan=2><img class='cov' src='cvs/tv_ov.jpg' id='v-ov' onclick='showModal(this)'></th><th>"+vidGames[j]+"</th><th>"+(i+1)+"</th></tr><tr><td>От винта! Выпуск "+(i+1);
	if (i > 48) vidRes += " ("+vidArray[0]+" по Игромании)";
	let restGames = vidGames.slice(0); 	restGames.splice(j, 1);
	if (restGames.length>0) vidRes += "<br><div style='font-size: 13px; color: #777; padding: 0px 20px'>+ <nobr>"+restGames.join("</nobr>, <nobr>")+" +</nobr></div>"
	vidRes += "</td><td>*</td></tr></table></div>";
	}
}
for (let g=0; g<tvs.length; g++) {
	let [tvName, tvPref] = tvs[g][0].split("|");
	for (let i=1; i<tvs[g].length; i++) {
		let vidPref = "https://www.youtube.com/watch?v=";
		vidArray = tvs[g][i].split('|'); vidGames = vidArray[0].split('+');  
			for (let j=0; j<vidGames.length; j++) if (re.test(vidGames[j])) {
		if (vidArray[2]) if (vidArray[2].indexOf('/')>-1) vidPref = '';
		vidRes += "<div class='dtab'><table class='tRes colV'><tr><th rowspan=2><img class='cov' src='cvs/tv_"+tvPref+".jpg' id='v-"+g+"' onclick='showModal(this)'></th><th>"+vidGames[j]+"</th><th>"+i+"</th></tr><tr><td>";
		vidRes += tvName + "<br> Выпуск "+i+" от "+vidArray[1]+"</td><td>";
		vidRes += "<a href='"+vidPref+vidArray[2]+"' target='_blank'><img width='26' src='misc/linked.png'></a></td></tr></table></div>";
		}
	}
}

if (bookRes+magRes+vidRes+PDFRes+discRes=="") return false;
let gridFix = "<div class='dtab flexFix'></div><div class='dtab flexFix'></div><div class='dtab flexFix'></div><div class='dtab flexFix'></div>";
prnt.innerHTML = magRes+bookRes+discRes+PDFRes+vidRes+gridFix;
	const end = new Date().getTime();
    console.log(end - start, "ms");
return true;
}

function getLink (mag,page) {
if (!webLinks.hasOwnProperty(mag)) return "<img width='15' src='misc/nolink.png'>";
let [webName, offset, fixes] = webLinks[mag].split("|");
if (fixes) {
	if ((fixes.indexOf('p')==0) && (Number(page) > (Number(fixes.slice(1))))) offset-=4;	// Сквозной постер
	else {
		let missPages = fixes.split(","); let i=0;
		while (Number(page) > Math.abs(missPages[i])) {
			Number(missPages[i]) < 0 ? offset++ : offset--;
			i++;
		}
	}
}
let web1p = Number(page)+Number(offset)-1; 
let web2p = (web1p%2) == 0 ? web1p-1 : web1p;
if (window.innerWidth < 800 || window.innerWidth < window.screen.width/2) return "<a href='https://archive.org/stream/"+webName+"#page/n"+web1p+"/mode/1up' target='_blank'><img width='26' src='misc/linked.png'></a>";
else return "<a href='https://archive.org/stream/"+webName+"#page/n"+web2p+"/mode/2up' target='_blank'><img width='26' src='misc/linked.png'></a>";
}

function getGalLink (mag) {
if (!webLinks.hasOwnProperty(mag)) return "<span><div class='galHint' style='background-color: rgba(255,0,0,0.5)'>"+mag.replace(/(\D_)|[^0-9-_]|_$/g, '').replace('_','-').slice(2)+"</div>";
let [webName, offset] = webLinks[mag].split("|");
return "<span><div class='galHint'><a href='https://archive.org/stream/"+webName+"#page/n0' target='_blank'>"+mag.replace(/(\D_)|[^0-9-_]/g, '').replace('_','-').slice(2)+"</a></div>";
}
function getSiteLink (mag,iss) {
let gRes = "<span><div class='galHint' style='background-color: rgba(0, 116, 232, 0.7)'><a href='"; 
if (mag=='im') gRes += "https://www.igromania.ru/magazine/"+iss+"/"; else if (mag=='mf') gRes += "https://www.mirf.ru/magazine/mir-fantastiki-"+iss+"/"; else if (mag=='lki') gRes += "http://lki.ru/archive.php?Num="+(iss+13); 
return gRes+"' target='_blank'>";
}

function showGal(mt,ms) {
let galIndex = []; 
let galArray = [];
let pubYear = '', issNum = '', lazyLoad = '', numfix=0, fullYear;
let [magName, magPref] = mags[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
if (magPref=='comp') galRes += "<h3 class='linkM' onClick='showGal(2)'>Сигнальный номер: Ба-Бах!</h3>";
if (magPref=='nim') galRes += "<h3 class='linkB' onClick='showBookGal(0)'>Ранее: альманах «Компьютерные игры»</h3>";
if (magPref=='exe') {galRes += "<h3 class='linkM' onClick='showGal(4)'>Ранее: «Магазин Игрушек»</h3>"; numfix+=17;}
if (magPref=='lki') {galRes += "<h3 class='linkB' onClick='showBookGal(7)'>Ранее: одноименная серия книг</h3>"; numfix+=13;}
if (magPref=='mik') galRes += "<h3 class='linkB' onClick='showBookGal(9)'>Ранее: одноименная газета</h3>";
for (let i=1; i<mags[mt].length; i++) {
	galArray = mags[mt][i].split('|'); galIndex.push(magPref+galArray[0]);
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); fullYear = (pubYear > 90) ? "19"+pubYear : "20"+pubYear; galRes += "<h2><a onClick=showYear("+fullYear+")>"+fullYear+"</a></h2>";
		if ((issNum == '')&&(galArray[0].slice(2) != (i+numfix))) issNum = 'start'; 
				if ((i>42)&&(window.location.protocol != "file:")) lazyLoad = "loading='lazy'";
		}
	if (magPref=='mg') {if (galArray[1]=="*,-") {galRes += "<img title='Нет данных' src='cvs/404.png'>"; continue;}}
	if (mags[mt][i].slice(3,6).indexOf("_|")>-1) numfix--; 
	if (issNum != '') issNum = "<div class='galIss'>"+(i+numfix)+"</div>";
	if (mags[mt][i].slice(3,5).indexOf("-")>-1) {numfix++; if (magPref=='mik' && (i==237||i==238)) numfix++;}
	if (magPref=='lki'||magPref=='mf'||(magPref=='im' && i>55)) galRes += getSiteLink (magPref,i)+galArray[0].slice(2)+"</a></div>";
	else galRes += getGalLink(magPref+galArray[0]);
	if (magPref=='xs') {if (galArray[1]=="*,-") {galRes += issNum+"<img id='m-"+mt+"-"+i+"' class='missing' src='cvs/"+magPref+galArray[0]+".jpg'></span>"; continue;}}
	galRes += issNum+"<img id='m-"+mt+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' "+lazyLoad+" onclick='showModal(this)'></span>";
	}
if (magPref=='pcr') galRes += "<br><br><br><h3 style='border-bottom: 3px #8e3ca2 solid' onClick='showDiscGal(0)'>Электронная версия журнала</h3>";
if (magPref=='bah') galRes += "<br><br><br><h3 class='linkM' onClick='showGal(3)'>Позже: «КомпАс»</h3>";
if (magPref=='mi') galRes += "<br><br><br><h3 class='linkM' onClick='showGal(8)'>Позже переименован в «Game.EXE»</h3>";
if (magPref=='gl') galRes += "<br><br><br><h3 class='linkM' onClick='showGal(22)'>Спецвыпуски</h3><h3 style='margin-left: 30px; border-bottom: 3px #b20f0b solid' onClick='showPDFGal(2)'>Неопубликованные материалы</h3>";
if (magPref=='glsp') galRes += "<br><br><br><h3 class='linkM' onClick='showGal(6)'>Регулярные выпуски</h3>";
prnt.innerHTML = galRes+"</div>";
if ((window.location.protocol == "file:")&&(ms !== undefined)) document.getElementById("m-"+mt+"-"+ms).scrollIntoView(false); else window.scrollTo(0,0);
}

function showBookGal(mt) {
let pubYear = '';
let galRes = "<div class='gal'><h1>"+books[mt][0]+"</h1>";
for (let i=1; i<books[mt].length; i++) {
	let bookID = books[mt][i].split("|")[0];
	let curYear = book_details[bookID].split("|")[3];
	if (curYear != pubYear) {pubYear = curYear; galRes += "<h2><a onClick=showYear("+pubYear+")>"+pubYear+"</a></h2>";}
	galRes += "<img title='"+bookID+"' id='b-"+mt+"-"+i+"' src='cvs/b_"+bookID+".jpg' onclick='showModal(this)'>";
	}
if (mt==0) galRes += "<br><br><br><h3 class='linkM' onClick='showGal(7)'>Позже: журнал «Навигатор игрового мира»</h3>";
if (mt==7) galRes += "<br><br><br><h3 class='linkM' onClick='showGal(14)'>Позже: одноименный журнал</h3>";
if (mt==9) galRes += "<br><br><br><h3 class='linkM' onClick='showGal(11)'>Позже: одноименный журнал</h3>";
prnt.innerHTML = galRes+"</div>";
window.scrollTo(0,0);
}

function showPDFGal(mt) {
let galIndex = [];
let galArray = [];
let pubYear = '';
let [magName, magPref, magURL] = PDFs[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
for (let i=1; i<PDFs[mt].length; i++) {
	galArray = PDFs[mt][i].split('|');
	galIndex.push(magPref+galArray[0]);
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); galRes += (pubYear > 90) ? "<h2>19"+pubYear+"</h2>" : "<h2>20"+pubYear+"</h2>";}	
	galRes += getGalLink(magPref+galArray[0])+"<img id='p-"+mt+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' onclick='showModal(this)'></span>";
	}
if (magURL) galRes += "<br><br><br><h3 style='border-bottom: 3px #800000 solid'><a href='http://"+magURL+"' target='_blank'>Сайт: "+magURL+"</a></h3>";
if (mt==2) galRes += "<br><br><br><h3 class='linkM' onClick='showGal(6)'>Регулярные выпуски</h3>";
prnt.innerHTML = galRes+"</div>";
}

function showDiscGal(mt) {
let galArray = [];
let pubYear = '';
let [magName, magPref] = dis[mt][0].split("|");
let galRes = "<div class='gal'><h1>"+magName+"</h1>";
for (let i=1; i<dis[mt].length; i++) {
	galArray = dis[mt][i].split('|');
	if (galArray[0].slice(0,2) != pubYear) {pubYear = galArray[0].slice(0,2); galRes += "<h2>19"+pubYear+"</h2>";}
	galRes += "<img title='"+galArray[0]+"' id='d-"+mt+"-"+i+"' src='cvs/d_"+magPref+galArray[0]+".jpg' onclick='showModal(this)'>";
	}
prnt.innerHTML = galRes+"</div>";
}

function showTVGal() {
let galRes = "<div class='gal'><h1>Телепередачи</h1><h2>С Бонусом и Гамовером (1995-2010)</h2>";
galRes += "<img title='От винта!' id='v-ov' src='cvs/tv_ov.jpg' style='cursor: pointer;' onclick='showModal(this)'>";
for (let i=0; i<tvs.length; i++) {
	let [tvName, tvPref] = tvs[i][0].split("|");
	galRes += "<img title='"+tvName+"' id='v-"+i+"' src='cvs/tv_"+tvPref+".jpg' style='cursor: pointer;' onclick='showModal(this)'>";
	}
prnt.innerHTML = galRes+"</div>";
}

window.prevMod = '';

function showModal(cov) {
modal.style.display = "flex";
let magGame = ''; let modRes = ''; let magArray = [];
let [mType,m1,m2] = cov.id.split("-");

if (mType == "b") {
modRes = "<img src='"+cov.src+"' onclick='showBookGal("+m1+")'>";
magArray = books[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#5d9d52";
}
else if (mType == "m") {
modRes = "<img src='"+cov.src+"' onclick='showGal("+m1+","+m2+")'>";
magArray = mags[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#345fb9";
}
else if (mType == "d") {
modRes = "<img src='"+cov.src+"' onclick='showDiscGal("+m1+")'>";
magArray = dis[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#8e3ca2";
}
else if (mType == "p") {
modRes = "<img src='"+cov.src+"' onclick='showPDFGal("+m1+")'>";
magArray = PDFs[m1][m2].split('|');
document.getElementById('modContent').style.borderColor = "#b20f0b";
}

else if (mType == "v") {
modRes = "<img src='"+cov.src+"' onclick='showTVGal()'>";
if (m1=='ov') {	let vidArray = []; for (let i=0; i<otvinta.length; i++) { vidArray = otvinta[i].split('|'); magArray.push.apply(magArray,vidArray[1].split('+')); }}
else for (let i=0; i<tvs[m1].length; i++) magArray.push.apply(magArray, tvs[m1][i].substring(0,tvs[m1][i].indexOf('|')).split('+'));
document.getElementById('modContent').style.borderColor = "fd8405";
}

let gamesArray = [...new Set(magArray.slice(1,magArray.length).map(x => x.replace(/,.+$/,"")))].sort();
modRes+="<select id='modSel' size='10'><option class='mobSelect' value='' disabled selected>Содержание номера</option>"
for (let j=0; j<gamesArray.length; j++) {
	magGame = gamesArray[j];
	if (magGame.indexOf("(") > -1) {magGame = magGame.replace(/ \(.*\)/ig, '').trim();}
	if (magGame.indexOf("'") > -1) {magGame = magGame.replace(/'/g, '^');}
	modRes+="<option value='"+magGame+"'>"+gamesArray[j]+"</option>"
	}
modRes+="</select>"
document.getElementById('modContent').style.height = cov.naturalHeight;
document.getElementById('modContent').innerHTML = modRes;
document.getElementById('modSel').style.height = cov.naturalHeight;
if (cov.id != prevMod) document.getElementById('modSel').scrollTop = 0;
prevMod = cov.id;
let timeout = null;
let modalSel = document.getElementById("modSel");
modalSel.onchange = function (e) {clearTimeout(timeout); timeout = setTimeout(function () {let fVal = modalSel.value.replace(/\^/g, '\''); wrapper(fVal+'='); sInp.value = fVal;}, 100)};
}

let modal = document.getElementById("covModal");
window.onclick = function (event) {if (event.target == modal) {
modal.style.display = "none"; 
}}

function prntHelp () {
let inF1="Приветствую вас на страницах путеводителя по игрожуру девяностых! <p>Наберите небольшую часть названия интересующей игры (civ, re ark, слон). Для удобства пользуйтесь клавишами Enter и Escape, или вовсе включите автопоиск. Если части слов не находятся, делается предположение, что набрана аббревиатура (lba, mm6), которая также ищется. Пробел перед номером части необязателен (gob2). Символ <b>=</b> в любом месте поикового запроса позволит найти точное совпадение без лишних результатов (gothic). Можно публиковать в сети ссылки на конкретные игры через хеш-символ: <a href='https://retroindex.github.io#homm2' target='_blank'>retroindex.github.io#homm2</a> <p>В выдаче формируется адаптивная сетка из 5 категорий: журналы, книги, дискмаги, сетевые журналы и телепередачи. Клик по обложке вызывает оглавление номера, из которого можно перейти как к галерее номеров данного издания, так и к новой выдаче по игре из оглавления. Таким образом можно путешествовать по базе, не прикасаясь к поиску. Альтернативный способ навигации — выбрать категорию и архив номеров игрового издания в меню справа от поиска.<p>Навигация по телепередачам (От винта!) вынесена на отдельную <a href='otvinta.html' target='_blank'>страницу</a> из-за повышенных требований к ширине вьюпорта.<p>Часть закладок в выдаче содержит ссылку на Archive.org, непосредственно на нужную страницу, или разворот хранящегося там документа. Возможные промахи сигнализируют о сбитой нумерации документа — удалены страницы с рекламой, сквозные постеры итд. На некоторых устройствах Архив будет пытаться подсунуть низкокачественные страницы, это исправляется переходом в полноэкранный режим (стрелка вниз в правом нижнем углу). <p>Впереди еще много работы по наполнению базы и улучшению приложения. При желании вы можете <a href='https://www.old-games.ru/forum/threads/88160/' target='og'>присоединиться</a> к проекту, или <a href='https://www.old-games.ru/forum/threads/31874/' target='og'>сообщить</a> о существовании неизвестных нашему сообществу изданий. Внесите свой вклад в историю игровой журналистики! <p align='right'>Morendil</p>";
prnt.innerHTML = "<div class='infMsg'>"+inF1+"</div>";
}

function ddMenu() {
let sel = "<nav><ul><li><a>Журналы</a><ul class='ulM'>";
for (i=0; i<mags.length-1; i++) sel+= "<li><a onclick='showGal("+i+")'>"+mags[i][0].split("|")[0]+"<span class='mc'> "+(mags[i].length-1)+"</span></a></li>"; sel+="</ul></li><li><a>Книги</a><ul class='ulB'>"
for (i=0; i<books.length; i++) sel+= "<li><a onclick='showBookGal("+i+")'>"+books[i][0]+"</a></li>"; sel += "</ul></li><li><a>Дискмаги</a><ul class='ulD'>"
for (i=0; i<dis.length; i++) sel+= "<li><a onclick='showDiscGal("+i+")'>"+dis[i][0].split("|")[0]+"</a></li>"; sel += "</ul></li><li><a>PDF</a><ul class='ulP'>"
for (i=0; i<PDFs.length; i++) sel+= "<li><a onclick='showPDFGal("+i+")'>"+PDFs[i][0].split("|")[0]+"</a></li>"; 
sel+="</ul></li><li><a onclick='showTVGal()'>ТВ</a></li></ul></nav>";
//sel+="</ul></li><li><a onclick='prntHelp()'>&nbsp;?&nbsp;</a></li></ul></nav>"
topRightCnt.innerHTML = sel;
}

function showYear(year) {
let galArray = []; 
let cur = Number(year); let galRes = "<div class='gal'><h1>";
galRes += (cur<1995) ? "<span>&nbsp;</span>" : "<span class='ns' onclick='showYear("+(cur-1)+")'>◄</span>"; galRes += cur;
galRes += (cur>2008) ? "<span>&nbsp;</span>" : "<span class='ns' onclick='showYear("+(cur+1)+")'>►</span></h1>";
for (let g=0; g<mags.length; g++) {
let [magName, magPref] = mags[g][0].split("|"); let noTitle = true; let items = 0;
for (let i=1; i<mags[g].length && items<12; i++) {
if (mags[g][i].slice(0,2) == String(year).slice(2)) {
	if (noTitle) {galRes += "<h2><a onclick='showGal("+g+")'>"+magName+"</a></h2>"; noTitle = false;}
	galArray = mags[g][i].split('|'); items++;
	if (magPref=='mg') {if (galArray[1]=="*,-") {galRes += "<img title='Нет данных' src='cvs/404.png'>"; continue;}}
	if (magPref=='lki'||magPref=='mf'||(magPref=='im' && i>55)) galRes += getSiteLink (magPref,i)+galArray[0].slice(2)+"</a></div>"; else galRes += getGalLink(magPref+galArray[0]);
	if (magPref=='xs') {if (galArray[1]=="*,-") {galRes += "<img id='m-"+g+"-"+i+"' class='missing' src='cvs/"+magPref+galArray[0]+".jpg'></span>"; continue;}}
	if ((magPref=='gl'||magPref=='mik') && items==12) galRes+='<div class="galIss" style="display: block; font-size: 100px; color: rgba(255,255,255,0.5);">+</div>';
	galRes += "<img id='m-"+g+"-"+i+"' src='cvs/"+magPref+galArray[0]+".jpg' onclick='showModal(this)'></span>";
}}}	
for (let g=0; g<books.length; g++) {
let noTitle = true;
for (let i=1; i<books[g].length; i++) {
let bookID = books[g][i].split("|")[0];
if (book_details[bookID].split("|")[3] == year) {
	if (noTitle) {galRes += "<h2><a onclick='showBookGal("+g+")'>"+books[g][0]+"</a></h2>"; noTitle = false;}
	galRes += "<img title='"+bookID+"' id='b-"+g+"-"+i+"' src='cvs/b_"+bookID+".jpg' onclick='showModal(this)'>";
}}}
prnt.innerHTML = galRes+"</div>";
window.scrollTo(0,0)
}

ddMenu();
//wrapper("homm2");
</script>
</body>
</html>